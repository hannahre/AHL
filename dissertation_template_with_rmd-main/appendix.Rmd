---
title: ''
---
# Appendices

## Appendix A: SEM and GSEM Analyses

```{r, echo = FALSE}
library(lme4)
library(lattice)
library(sjstats)
library(jtools)
library(ROCR)
library(sjPlot)
library(performance)
library(XML)
library(kableExtra)
library(tidyverse)
library(caTools)
library(fastDummies)
library(semptools)
library(semoutput)
library(lavaan)
library(semPlot)
library(stargazer)
library(semTable)
library(rstatix)
library(gtsummary)
library(forcats)
library(haven)
load("waves123.long.rda")
load("waves123.long.complete.rda")
load("waves123.wide.rda")
load("waves12.wide.complete.rda")
load("waves23.wide.complete.rda")
load("waves13.wide.complete.rda")
# Tutorials
# https://lmudge13.github.io/sample_code/mixed_effects.html
# Converting html to pdf https://github.com/gorkang/html2latex/
```

```{r path-data-recodes2, echo = FALSE, results='hide'}
# Order Education levels
path.waves123.wide <- waves123.wide %>%
  mutate(waves123.wide = factor(Education_W1, levels = c("Less than High School", "HS Diploma/GED", 
                                                "Some College/AA Degree", "College Grad",
                                                "Graduate or Professional Degree"), labels = 1:5, ordered = TRUE))
# Convert to numeric to be used as ordinal variable
path.waves123.wide$Education_W1 <- as.numeric(path.waves123.wide$Education_W1)
# Order education levels
path.waves123.wide <- path.waves123.wide %>%
  mutate(path.waves123.wide = factor(Education_W2, levels = c("Less than High School", "HS Diploma/GED", 
                                                "Some College/AA Degree", "College Grad",
                                                "Graduate or Professional Degree"), labels = 1:5, ordered = TRUE))
# Convert to numeric to be used as ordinal variable
path.waves123.wide$Education_W2 <- as.numeric(path.waves123.wide$Education_W2)
# Order Education levels
path.waves123.wide <- path.waves123.wide %>%
  mutate(path.waves123.wide = factor(Education_W3, levels = c("Less than High School", "HS Diploma/GED", 
                                                "Some College/AA Degree", "College Grad",
                                                "Graduate or Professional Degree"), labels = 1:5, ordered = TRUE))
# Convert to numeric to be used as ordinal variable
path.waves123.wide$Education_W3 <- as.numeric(path.waves123.wide$Education_W3)

# Create dummy variables for race
path.waves123.wide <- dummy_cols(path.waves123.wide, select_columns = 'Race_W2', ignore_na = TRUE)
path.waves123.wide <- rename(path.waves123.wide, 
                             MexicanHispanic_W2 = "Race_W2_Mexican American and Other Hispanic",
                             Black_W2 = "Race_W2_Non-Hispanic Black", 
                             OtherRace_W2 = "Race_W2_Other Race",
                             White_W2 = "Race_W2_Non-Hispanic White")

# Order SRH levels
path.waves123.wide <- path.waves123.wide %>%
  mutate(waves123.wide = factor(SRH_W2, levels = c("Poor", "Fair", "Good",
                                                   "Very Good", "Excellent"), 
                                labels = 1:5, 
                                ordered = TRUE))
# Convert to numeric to be used as ordinal variable
path.waves123.wide$SRH_W2 <- as.numeric(path.waves123.wide$SRH_W2)

# Order SRH levels
path.waves123.wide <- path.waves123.wide %>%
  mutate(waves123.wide = factor(SRH_W3, levels = c("Poor", "Fair", "Good",
                                                   "Very Good", "Excellent"), 
                                labels = 1:5, 
                                ordered = TRUE))
# Convert to numeric to be used as ordinal variable
path.waves123.wide$SRH_W3 <- as.numeric(path.waves123.wide$SRH_W3)
```

```{r listwise-delete-path-data2, echo =FALSE}
myvars <- c("mindbody_W2", "mindbody_W3", "altmed_W2", "altmed_W3", "pna_W2", "pna_W3", "manipulative_W2", "manipulative_W3", "totalCams_W2", "totalCams_W3", "SumChron_W2", "SumChron_W3", "SRH_W2", "SRH_W3", "LogIncome_W1", "Education_W1", "Sex_W1", "Age_W2", "Age_W3", "Marital_W2", "Marital_W3", "HlthInsurance_W2", "HlthInsurance_W3", "HLSelf_W2", "HLSelf_W3", "Spiritual_W2", "Spiritual_W3", "Religion_W2", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Diabetes_W1", "Diabetes_W2", "Diabetes_W3", "Respiratory_W1", "Respiratory_W2", "Respiratory_W3", "DepAnx_W1", "DepAnx_W2", "DepAnx_W3", "HighBP_W1", "HighBP_W2", "HighBP_W3", "ChronicPain_W2", "ChronicPain_W3", "Depression_W1", "Depression_W2", "Depression_W3")

path.complete <- path.waves123.wide[myvars]

path.complete <- path.complete[complete.cases(path.complete),]

```

```{r, echo = FALSE}
require(foreign)
write.dta(path.complete, "path.dta")
library(Statamarkdown)

stataexe <- "C:/Program Files/Stata17/StataBE-64.exe"
knitr::opts_chunk$set(engine.path=list(stata=stataexe))

```

## Total CAMs 

### Chronic Conditions

#### SEM Results

```{r model-totcams-chron, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
totalCams_W3 ~ a*LogIncome_W1 
SumChron_W3 ~ b*LogIncome_W1
# Direct Effect - Education
totalCams_W3 ~ c*Education_W1
SumChron_W3 ~ d*Education_W1
# Mediator effects - Income 
SumChron_W2 ~ e*LogIncome_W1 
totalCams_W3 ~ f*SumChron_W2
totalCams_W2 ~ g*LogIncome_W1
SumChron_W3 ~ h*totalCams_W2
# Mediator effects - Education
totalCams_W2 ~ i*Education_W1
SumChron_W2 ~ j*Education_W1 
# Control for previous wave
totalCams_W3 ~ totalCams_W2
SumChron_W3 ~ SumChron_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
totalCams_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
totalCams_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
totalCams_W2 ~~ SumChron_W2
totalCams_W3 ~~ SumChron_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ.2, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.totcams.chron <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.totcams.chron <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "totalCams_W2"
m[3, 2] <- "SumChron_W2"
m[1, 3] <- "totalCams_W3"
m[4, 3] <- "SumChron_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("totalCams_W3 ~ Education_W1" = .20, 
                      "SumChron_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             totalCams_W2 = "Total CAMs W2",
                             SumChron_W2 = "Sum Chron W2", 
                             totalCams_W3 = "Total CAMs W3",
                             SumChron_W3 = "Sum Chron W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-totcams-chron, echo = FALSE, fig.cap="Path Model: SES, Total CAMs, and Chronic Conditions"}
# Create final plot
plot(path_dia5)
```

```{r de-totcams-chron, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="Direct Effects: SES, Total CAMs, and Chronic Conditions",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()
```

```{r create-ie-totcams-chron, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.totCams <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, "*b*"=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, "$\\beta$"=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.totCams <- tab.IE.totCams %>%
  slice(match(x, Path))
```

```{r ie-totcams-chron, echo=FALSE}
tab.IE.totCams %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Total CAMs \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Total CAMs \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Total CAMs \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Total CAMs \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Total CAMs, and Chronic Conditions",
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

```{r fit-totcams-chron, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               caption="Fit Statistics: SES, Chronic Conditions, and Total CAMs Path Model",
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM Results

```{stata, include=FALSE}
use path.dta, clear

# remove uppercase from variables
rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

# Run gsem
gsem(totalcams_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (sumchron_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (totalcams_W3 <- logincome_W1 education_W1 sumchron_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (sumchron_W3 <- logincome_W1 education_W1 sumchron_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson), post

regsave using totcamschron, pval ci replace

nlcom (_b[sumchron_W2:logincome_W1]*_b[totalcams_W3:sumchron_W2]) (_b[totalcams_W3:logincome_W1] + _b[sumchron_W2:logincome_W1]*_b[totalcams_W3:sumchron_W2]) (_b[totalcams_W2:logincome_W1]*_b[sumchron_W3:totalcams_W2]) (_b[sumchron_W3:logincome_W1] + _b[totalcams_W2:logincome_W1]*_b[sumchron_W3:totalcams_W2]) (_b[sumchron_W2:education_W1]*_b[totalcams_W3:sumchron_W2]) (_b[totalcams_W3:education_W1] + _b[sumchron_W2:education_W1]*_b[totalcams_W3:sumchron_W2]) (_b[totalcams_W2:education_W1]*_b[sumchron_W3:totalcams_W2]) (_b[sumchron_W3:education_W1] + _b[totalcams_W2:education_W1]*_b[sumchron_W3:totalcams_W2]), post

esttab using "test.csv", cells("b se p ci_l ci_u")  replace

```

```{r read-in-totcams-chron-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/totcamschron.dta")
totcamschron <- read_dta(path)

# Convert to data frame
totcamschron <- as.data.frame(totcamschron)

# Add indicator column 
 
# Split name column into firstname and last name
totcamschron <-  totcamschron %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
totcamschron <- subset(totcamschron, select = -c(N) )
```

```{r de-gsem-totcams-chron, echo = FALSE}
totcamschron %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Total CAMs, and Chronic Conditions",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-totcamchron-table, echo = FALSE}
# Import organized loadings table from excel
totcamchron.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed Model/test.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
totcamchron.table[] <- lapply(totcamchron.table, gsub, pattern='=', replacement='')

# Remove last row 
totcamchron.table <- head(totcamchron.table, - 1) 

# Rename columns
totcamchron.table <- totcamchron.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
totcamchron.table <- totcamchron.table[-c(1,2), ]

# convert p-value to numeric
totcamchron.table$`p-value` <- as.numeric(totcamchron.table$`p-value`)

# Remove row names
rownames(totcamchron.table) <- NULL
```

```{r ie-gsem-totcams-chron, echo = FALSE}
totcamchron.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Total CAMs \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Total CAMs \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Conditions \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Total CAMs \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Total CAMs \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Total CAMs, and Chronic Conditions") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```


### Self-Reported Health 

#### SEM Results

```{r model-totcams-SRH, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
totalCams_W3 ~ a*LogIncome_W1 
SRH_W3 ~ b*LogIncome_W1
# Direct Effect - Education
totalCams_W3 ~ c*Education_W1
SRH_W3 ~ d*Education_W1
# Mediator effects - Income 
SRH_W2 ~ e*LogIncome_W1 
totalCams_W3 ~ f*SRH_W2
totalCams_W2 ~ g*LogIncome_W1
SRH_W3 ~ h*totalCams_W2
# Mediator effects - Education
totalCams_W2 ~ i*Education_W1
SRH_W2 ~ j*Education_W1 
# Control for previous wave
totalCams_W3 ~ totalCams_W2
SRH_W3 ~ SRH_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
totalCams_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
totalCams_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
totalCams_W2 ~~ SRH_W2
totalCams_W3 ~~ SRH_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.totcams.SRH <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.totcams.SRH <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "totalCams_W2"
m[3, 2] <- "SRH_W2"
m[1, 3] <- "totalCams_W3"
m[4, 3] <- "SRH_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("totalCams_W3 ~ Education_W1" = .20, 
                      "SRH_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             totalCams_W2 = "Total CAMs W2",
                             SRH_W2 = "SRH W2", 
                             totalCams_W3 = "Total CAMs W3",
                             SRH_W3 = "SRH W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-totcams-SRH, echo = FALSE, fig.cap="Path Model: SES, Total CAMs, and Self-Reported Health"}
# Create final plot
plot(path_dia5)
```

```{r de-totcams-SRH, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Total CAMs, and Self-Reported Health",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-totcams-SRH, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.totCams.srh <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.totCams.srh <- tab.IE.totCams.srh %>%
  slice(match(x, Path))
```

```{r ie-totcams-SRH, echo=FALSE}
tab.IE.totCams.srh %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Total CAMs \U2192 Self-Reported Health")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Total CAMs, and Self-Reported Health",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-totcams-SRH, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Self-Reported Health, and Total CAMs Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM Results

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(totalcams_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (srh_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit) (totalcams_W3 <- logincome_W1 education_W1 srh_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (srh_W3 <- logincome_W1 education_W1 srh_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit)

regsave using totcamssrh, pval ci replace

nlcom (_b[srh_W2:logincome_W1]*_b[totalcams_W3:srh_W2]) (_b[totalcams_W3:logincome_W1] + _b[srh_W2:logincome_W1]*_b[totalcams_W3:srh_W2]) (_b[totalcams_W2:logincome_W1]*_b[srh_W3:totalcams_W2]) (_b[srh_W3:logincome_W1] + _b[totalcams_W2:logincome_W1]*_b[srh_W3:totalcams_W2]) (_b[srh_W2:education_W1]*_b[totalcams_W3:srh_W2]) (_b[totalcams_W3:education_W1] + _b[srh_W2:education_W1]*_b[totalcams_W3:srh_W2]) (_b[totalcams_W2:education_W1]*_b[srh_W3:totalcams_W2]) (_b[srh_W3:education_W1] + _b[totalcams_W2:education_W1]*_b[srh_W3:totalcams_W2]), post

esttab using "ietotcamssrh.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-totcams-srh-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/totcamssrh.dta")
totcamssrh <- read_dta(path)

# Convert to data frame
totcamssrh <- as.data.frame(totcamssrh)

# Add indicator column 
 
# Split name column into firstname and last name
totcamssrh <-  totcamssrh %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column
totcamssrh <- subset(totcamssrh, select = -c(N) )

# Drop cut rows
totcamssrh <- slice(totcamssrh, 1:(n() - 8))
```

```{r de-gsem-totcams-srh, echo = FALSE}
totcamssrh %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Total CAMs, and Self-Reported Health",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-ietotcamsrh-table, echo = FALSE}
# Import indirect and total effects table
ietotcamsrh.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/ietotcamssrh.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
ietotcamsrh.table[] <- lapply(ietotcamsrh.table, gsub, pattern='=', replacement='')

# Remove last row 
ietotcamsrh.table <- head(ietotcamsrh.table, - 1) 

# Rename columns
ietotcamsrh.table <- ietotcamsrh.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
ietotcamsrh.table <- ietotcamsrh.table[-c(1,2), ]

# convert p-value to numeric
ietotcamsrh.table$`p-value` <- as.numeric(ietotcamsrh.table$`p-value`)

# Remove row names
rownames(ietotcamsrh.table) <- NULL
```

```{r ie-gsem-totcams-srh, echo = FALSE}
ietotcamsrh.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Self-Reported Health \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Total CAMs \U2192 Self-Reported Health")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Total CAMs, and Self-Reported Health") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Diabetes 

#### SEM Results 

```{r model-totcams-diabetes, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
totalCams_W3 ~ a*LogIncome_W1 
Diabetes_W3 ~ b*LogIncome_W1
# Direct Effect - Education
totalCams_W3 ~ c*Education_W1
Diabetes_W3 ~ d*Education_W1
# Mediator effects - Income 
Diabetes_W2 ~ e*LogIncome_W1 
totalCams_W3 ~ f*Diabetes_W2
totalCams_W2 ~ g*LogIncome_W1
Diabetes_W3 ~ h*totalCams_W2
# Mediator effects - Education
totalCams_W2 ~ i*Education_W1
Diabetes_W2 ~ j*Education_W1 
# Control for previous wave
totalCams_W3 ~ totalCams_W2
Diabetes_W3 ~ Diabetes_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
totalCams_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
Diabetes_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
totalCams_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
Diabetes_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
totalCams_W2 ~~ Diabetes_W2
totalCams_W3 ~~ Diabetes_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.totcams.diabetes <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.totcams.diabetes <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "totalCams_W2"
m[3, 2] <- "Diabetes_W2"
m[1, 3] <- "totalCams_W3"
m[4, 3] <- "Diabetes_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("totalCams_W3 ~ Education_W1" = .20, 
                      "Diabetes_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             totalCams_W2 = "Total CAMs W2",
                             Diabetes_W2 = "Diabetes W2", 
                             totalCams_W3 = "Total CAMs W3",
                             Diabetes_W3 = "Diabetes W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-totcams-diabetes, echo = FALSE, fig.cap="Path Model: SES, Total CAMs, and Diabetes"}
# Create final plot
plot(path_dia5)
```

```{r de-totcams-diabetes, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "Diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Total CAMs, and Diabetes",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-totcams-diabetes, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.totCams.diabetes <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.totCams.diabetes <- tab.IE.totCams.diabetes %>%
  slice(match(x, Path))
```

```{r ie-totcams-diabetes, echo=FALSE}
tab.IE.totCams.diabetes %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Total CAMs \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Total CAMs \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Total CAMs \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Total CAMs \U2192 Diabetes")) %>%  
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Total CAMs, and Diabetes",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-totcams-diabetes, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Diabetes, and Total CAMs Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM Results

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3)

set seed 1234

gsem(totalcams_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (diabetes_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (totalcams_W3 <- logincome_W1 education_W1 diabetes_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (diabetes_W3 <- logincome_W1 education_W1 diabetes_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using totcamsdiabetes, pval ci replace

nlcom (_b[diabetes_W2:logincome_W1]*_b[totalcams_W3:diabetes_W2]) (_b[totalcams_W3:logincome_W1] + _b[diabetes_W2:logincome_W1]*_b[totalcams_W3:diabetes_W2]) (_b[totalcams_W2:logincome_W1]*_b[diabetes_W3:totalcams_W2]) (_b[diabetes_W3:logincome_W1] + _b[totalcams_W2:logincome_W1]*_b[diabetes_W3:totalcams_W2]) (_b[diabetes_W2:education_W1]*_b[totalcams_W3:diabetes_W2]) (_b[totalcams_W3:education_W1] + _b[diabetes_W2:education_W1]*_b[totalcams_W3:diabetes_W2]) (_b[totalcams_W2:education_W1]*_b[diabetes_W3:totalcams_W2]) (_b[diabetes_W3:education_W1] + _b[totalcams_W2:education_W1]*_b[diabetes_W3:totalcams_W2]), post

esttab using "ietotcamsdiabetes.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-totcams-diabetes-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/totcamsdiabetes.dta")
totcamsdiabetes <- read_dta(path)

# Convert to data frame
totcamsdiabetes <- as.data.frame(totcamsdiabetes)

# Add indicator column 
 
# Split name column into firstname and last name
totcamsdiabetes <-  totcamsdiabetes %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
totcamsdiabetes <- subset(totcamsdiabetes, select = -c(N) )
```

```{r de-gsem-totcams-diabetes, echo = FALSE}
totcamsdiabetes %>%
  mutate(Indicator = replace(Indicator, Indicator == "diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Total CAMs, and Diabetes",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-ietotcamsdiabetes-table, echo = FALSE}
# Import indirect and total effects table
ietotcamsdiabetes.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/ietotcamsdiabetes.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
ietotcamsdiabetes.table[] <- lapply(ietotcamsdiabetes.table, gsub, pattern='=', replacement='')

# Remove last row 
ietotcamsdiabetes.table <- head(ietotcamsdiabetes.table, - 1) 

# Rename columns
ietotcamsdiabetes.table <- ietotcamsdiabetes.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
ietotcamsdiabetes.table <- ietotcamsdiabetes.table[-c(1,2), ]

# convert p-value to numeric
ietotcamsdiabetes.table$`p-value` <- as.numeric(ietotcamsdiabetes.table$`p-value`)

# Remove row names
rownames(ietotcamsdiabetes.table) <- NULL
```

```{r ie-gsem-totcams-diabetes, echo = FALSE}
ietotcamsdiabetes.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Total CAMs \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Total CAMs \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Diabetes \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Total CAMs \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Total CAMs \U2192 Diabetes")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Total CAMs, and Diabetes") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Chronic Pain 

#### SEM Results

```{r model-totcams-chronicpain, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
totalCams_W3 ~ a*LogIncome_W1 
ChronicPain_W3 ~ b*LogIncome_W1
# Direct Effect - Education
totalCams_W3 ~ c*Education_W1
ChronicPain_W3 ~ d*Education_W1
# Mediator effects - Income 
ChronicPain_W2 ~ e*LogIncome_W1 
totalCams_W3 ~ f*ChronicPain_W2
totalCams_W2 ~ g*LogIncome_W1
ChronicPain_W3 ~ h*totalCams_W2
# Mediator effects - Education
totalCams_W2 ~ i*Education_W1
ChronicPain_W2 ~ j*Education_W1 
# Control for previous wave
totalCams_W3 ~ totalCams_W2
ChronicPain_W3 ~ ChronicPain_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
totalCams_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
totalCams_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
totalCams_W2 ~~ ChronicPain_W2
totalCams_W3 ~~ ChronicPain_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.totcams.chronicpain <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.totcams.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "totalCams_W2"
m[3, 2] <- "ChronicPain_W2"
m[1, 3] <- "totalCams_W3"
m[4, 3] <- "ChronicPain_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("totalCams_W3 ~ Education_W1" = .20, 
                      "ChronicPain_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             totalCams_W2 = "Total CAMs W2",
                             ChronicPain_W2 = "Chronic Pain W2", 
                             totalCams_W3 = "Total CAMs W3",
                             ChronicPain_W3 = "Chronic Pain W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-totcams-chronicpain, echo = FALSE, fig.cap="Path Model: SES, Total CAMs, and Chronic Pain"}
# Create final plot
plot(path_dia5)
```

```{r de-totcams-chronicpain, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Total CAMs, and Chronic Pain",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-totcams-chronicpain, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.totCams.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.totCams.chronicpain <- tab.IE.totCams.chronicpain %>%
  slice(match(x, Path))
```

```{r ie-totcams-chronicpain, echo=FALSE}
tab.IE.totCams.chronicpain %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Total CAMs \U2192 Chronic Pain")) %>%  
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Total CAMs, and Chronic Pain",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-totcams-chronicpain, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Pain, and Total CAMs Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(totalcams_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (chronicpain_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (totalcams_W3 <- logincome_W1 education_W1 chronicpain_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (chronicpain_W3 <- logincome_W1 education_W1 chronicpain_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using totcamschronicpain, pval ci replace

nlcom (_b[chronicpain_W2:logincome_W1]*_b[totalcams_W3:chronicpain_W2]) (_b[totalcams_W3:logincome_W1] + _b[chronicpain_W2:logincome_W1]*_b[totalcams_W3:chronicpain_W2]) (_b[totalcams_W2:logincome_W1]*_b[chronicpain_W3:totalcams_W2]) (_b[chronicpain_W3:logincome_W1] + _b[totalcams_W2:logincome_W1]*_b[chronicpain_W3:totalcams_W2]) (_b[chronicpain_W2:education_W1]*_b[totalcams_W3:chronicpain_W2]) (_b[totalcams_W3:education_W1] + _b[chronicpain_W2:education_W1]*_b[totalcams_W3:chronicpain_W2]) (_b[totalcams_W2:education_W1]*_b[chronicpain_W3:totalcams_W2]) (_b[chronicpain_W3:education_W1] + _b[totalcams_W2:education_W1]*_b[chronicpain_W3:totalcams_W2]), post

esttab using "ietotcamschronicpain.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-totcams-chronicpain-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/totcamschronicpain.dta")
totcamschronicpain <- read_dta(path)

# Convert to data frame
totcamschronicpain <- as.data.frame(totcamschronicpain)

# Add indicator column 
 
# Split name column into firstname and last name
totcamschronicpain <-  totcamschronicpain %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
totcamschronicpain <- subset(totcamschronicpain, select = -c(N) )
```

```{r de-gsem-totcams-chronicpain, echo = FALSE}
totcamschronicpain %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Total CAMs, and Chronic Pain",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-ietotcamschronicpain-table, echo = FALSE}
# Import indirect and total effects table
ietotcamschronicpain.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/ietotcamschronicpain.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
ietotcamschronicpain.table[] <- lapply(ietotcamschronicpain.table, gsub, pattern='=', replacement='')

# Remove last row 
ietotcamschronicpain.table <- head(ietotcamschronicpain.table, - 1) 

# Rename columns
ietotcamschronicpain.table <- ietotcamschronicpain.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
ietotcamschronicpain.table <- ietotcamschronicpain.table[-c(1,2), ]

# convert p-value to numeric
ietotcamschronicpain.table$`p-value` <- as.numeric(ietotcamschronicpain.table$`p-value`)

# Remove row names
rownames(ietotcamschronicpain.table) <- NULL
```

```{r ie-gsem-totcams-chronicpain, echo = FALSE}
ietotcamschronicpain.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Pain \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Total CAMs \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Total CAMs, and Chronic Pain") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### High Blood Pressure

#### SEM 

```{r model-totcams-highbp, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
totalCams_W3 ~ a*LogIncome_W1 
HighBP_W3 ~ b*LogIncome_W1
# Direct Effect - Education
totalCams_W3 ~ c*Education_W1
HighBP_W3 ~ d*Education_W1
# Mediator effects - Income 
HighBP_W2 ~ e*LogIncome_W1 
totalCams_W3 ~ f*HighBP_W2
totalCams_W2 ~ g*LogIncome_W1
HighBP_W3 ~ h*totalCams_W2
# Mediator effects - Education
totalCams_W2 ~ i*Education_W1
HighBP_W2 ~ j*Education_W1 
# Control for previous wave
totalCams_W3 ~ totalCams_W2
HighBP_W3 ~ HighBP_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
totalCams_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
HighBP_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
totalCams_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
HighBP_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
totalCams_W2 ~~ HighBP_W2
totalCams_W3 ~~ HighBP_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.totcams.highbp <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.totcams.highbp <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "totalCams_W2"
m[3, 2] <- "HighBP_W2"
m[1, 3] <- "totalCams_W3"
m[4, 3] <- "HighBP_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("totalCams_W3 ~ Education_W1" = .20, 
                      "HighBP_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             totalCams_W2 = "Total CAMs W2",
                             HighBP_W2 = "High BP W2", 
                             totalCams_W3 = "Total CAMs W3",
                             HighBP_W3 = "High BP W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-totcams-highbp, echo = FALSE, fig.cap="Path Model: SES, Total CAMs, and High Blood Pressure"}
# Create final plot
plot(path_dia5)
```

```{r de-totcams-highbp, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "HighBP_W2", "High BP Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HighBP_W3", "High BP Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HighBP_W2", "High BP Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HighBP_W3", "High BP Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Total CAMs, and High Blood Pressure",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-totcams-highbp, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.totCams.highbp <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.totCams.highbp <- tab.IE.totCams.highbp %>%
  slice(match(x, Path))
```

```{r ie-totcams-highbp, echo=FALSE}
tab.IE.totCams.highbp %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Total CAMs \U2192 High Blood Pressure")) %>%   
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Total CAMs, and High Blood Pressure",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-totcams-highbp, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, High Blood Pressure, and Total CAMs Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(totalcams_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (highbp_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (totalcams_W3 <- logincome_W1 education_W1 highbp_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (highbp_W3 <- logincome_W1 education_W1 highbp_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using totcamshighbp, pval ci replace

nlcom (_b[highbp_W2:logincome_W1]*_b[totalcams_W3:highbp_W2]) (_b[totalcams_W3:logincome_W1] + _b[highbp_W2:logincome_W1]*_b[totalcams_W3:highbp_W2]) (_b[totalcams_W2:logincome_W1]*_b[highbp_W3:totalcams_W2]) (_b[highbp_W3:logincome_W1] + _b[totalcams_W2:logincome_W1]*_b[highbp_W3:totalcams_W2]) (_b[highbp_W2:education_W1]*_b[totalcams_W3:highbp_W2]) (_b[totalcams_W3:education_W1] + _b[highbp_W2:education_W1]*_b[totalcams_W3:highbp_W2]) (_b[totalcams_W2:education_W1]*_b[highbp_W3:totalcams_W2]) (_b[highbp_W3:education_W1] + _b[totalcams_W2:education_W1]*_b[highbp_W3:totalcams_W2]), post

esttab using "ietotcamshighbp.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-totcams-highbp-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/totcamshighbp.dta")
totcamshighbp <- read_dta(path)

# Convert to data frame
totcamshighbp <- as.data.frame(totcamshighbp)

# Add indicator column 
 
# Split name column into firstname and last name
totcamshighbp <-  totcamshighbp %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
totcamshighbp <- subset(totcamshighbp, select = -c(N) )
```

```{r de-gsem-totcams-highbp, echo = FALSE}
totcamshighbp %>%
  mutate(Indicator = replace(Indicator, Indicator == "highbp_W2", "High Blood Pressure Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "highbp_W3", "High Blood Pressure Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "highbp_W2", "High Blood Pressure Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "highbp_W3", "High Blood Pressure Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Total CAMs, and High Blood Pressure",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-ietotcamshighbp-table, echo = FALSE}
# Import indirect and total effects table
ietotcamshighbp.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/ietotcamshighbp.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
ietotcamshighbp.table[] <- lapply(ietotcamshighbp.table, gsub, pattern='=', replacement='')

# Remove last row 
ietotcamshighbp.table <- head(ietotcamshighbp.table, - 1) 

# Rename columns
ietotcamshighbp.table <- ietotcamshighbp.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
ietotcamshighbp.table <- ietotcamshighbp.table[-c(1,2), ]

# convert p-value to numeric
ietotcamshighbp.table$`p-value` <- as.numeric(ietotcamshighbp.table$`p-value`)

# Remove row names
rownames(ietotcamshighbp.table) <- NULL
```

```{r ie-gsem-totcams-highbp, echo = FALSE}
ietotcamshighbp.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 High Blood Pressure \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Total CAMs \U2192 High Blood Pressure")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Total CAMs, and High Blood Pressure") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Depression/Anxiety

#### SEM 

```{r model-totcams-dep, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
totalCams_W3 ~ a*LogIncome_W1 
DepAnx_W3 ~ b*LogIncome_W1
# Direct Effect - Education
totalCams_W3 ~ c*Education_W1
DepAnx_W3 ~ d*Education_W1
# Mediator effects - Income 
DepAnx_W2 ~ e*LogIncome_W1 
totalCams_W3 ~ f*DepAnx_W2
totalCams_W2 ~ g*LogIncome_W1
DepAnx_W3 ~ h*totalCams_W2
# Mediator effects - Education
totalCams_W2 ~ i*Education_W1
DepAnx_W2 ~ j*Education_W1 
# Control for previous wave
totalCams_W3 ~ totalCams_W2
DepAnx_W3 ~ DepAnx_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
totalCams_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
totalCams_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
totalCams_W2 ~~ DepAnx_W2
totalCams_W3 ~~ DepAnx_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.totcams.dep <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.totcams.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "totalCams_W2"
m[3, 2] <- "DepAnx_W2"
m[1, 3] <- "totalCams_W3"
m[4, 3] <- "DepAnx_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("totalCams_W3 ~ Education_W1" = .20, 
                      "DepAnx_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             totalCams_W2 = "Total CAMs W2",
                             DepAnx_W2 = "DepAnx W2", 
                             totalCams_W3 = "Total CAMs W3",
                             DepAnx_W3 = "DepAnx W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-totcams-dep, echo = FALSE, fig.cap="Path Model: SES, Total CAMs, and Depression"}
# Create final plot
plot(path_dia5)
```

```{r de-totcams-dep, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Total CAMs, and Depression/Anxiety",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-totcams-dep, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.totCams.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.totCams.dep <- tab.IE.totCams.dep %>%
  slice(match(x, Path))
```

```{r ie-totcams-dep, echo=FALSE}
tab.IE.totCams.dep %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Total CAMs \U2192 Depression/Anxiety")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Total CAMs, and Depression/Anxiety",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-totcams-dep, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Depression/Anxiety, and Total CAMs Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM 

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3 Depression_W1 Depression_W2 Depression_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3 depression_W1 depression_W2 depression_W3)

set seed 1234
gsem(totalcams_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (depanx_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (totalcams_W3 <- logincome_W1 education_W1 depanx_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (depanx_W3 <- logincome_W1 education_W1 depanx_W2 totalcams_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using totcamsdepression, pval ci replace

nlcom (_b[depanx_W2:logincome_W1]*_b[totalcams_W3:depanx_W2]) (_b[totalcams_W3:logincome_W1] + _b[depanx_W2:logincome_W1]*_b[totalcams_W3:depanx_W2]) (_b[totalcams_W2:logincome_W1]*_b[depanx_W3:totalcams_W2]) (_b[depanx_W3:logincome_W1] + _b[totalcams_W2:logincome_W1]*_b[depanx_W3:totalcams_W2]) (_b[depanx_W2:education_W1]*_b[totalcams_W3:depanx_W2]) (_b[totalcams_W3:education_W1] + _b[depanx_W2:education_W1]*_b[totalcams_W3:depanx_W2]) (_b[totalcams_W2:education_W1]*_b[depanx_W3:totalcams_W2]) (_b[depanx_W3:education_W1] + _b[totalcams_W2:education_W1]*_b[depanx_W3:totalcams_W2]), post

esttab using "ietotcamsdepression.csv", cells("b se p ci_l ci_u") replace
```

```{r read-in-totcams-depression-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/totcamsdepression.dta")
totcamsdepression <- read_dta(path)

# Convert to data frame
totcamsdepression <- as.data.frame(totcamsdepression)

# Add indicator column 
 
# Split name column into firstname and last name
totcamsdepression <-  totcamsdepression %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
totcamsdepression <- subset(totcamsdepression, select = -c(N) )

# Drop cut rows
# totcamsdepression <- slice(totcamsdepression, 1:(n() - 14))
```

```{r de-gsem-totcams-depression, echo = FALSE}
totcamsdepression %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Total CAMs, and Depression/Anxiety",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-ietotcamsdepression-table, echo = FALSE}
# Import indirect and total effects table
ietotcamsdepression.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/ietotcamsdepression.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
ietotcamsdepression.table[] <- lapply(ietotcamsdepression.table, gsub, pattern='=', replacement='')

# Remove last row 
ietotcamsdepression.table <- head(ietotcamsdepression.table, - 1) 

# Rename columns
ietotcamsdepression.table <- ietotcamsdepression.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
ietotcamsdepression.table <- ietotcamsdepression.table[-c(1,2), ]

# convert p-value to numeric
ietotcamsdepression.table$`p-value` <- as.numeric(ietotcamsdepression.table$`p-value`)

# Remove row names
rownames(ietotcamsdepression.table) <- NULL
```

```{r ie-gsem-totcams-depression, echo = FALSE}
ietotcamsdepression.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Total CAMs")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Total CAMs \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Total CAMs, and Depression/Anxiety") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

## Mind-Body Medicines 

### Chronic Conditions 

#### SEM

```{r model-mb-chron, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
mindbody_W3 ~ a*LogIncome_W1 
SumChron_W3 ~ b*LogIncome_W1
# Direct Effect - Education
mindbody_W3 ~ c*Education_W1
SumChron_W3 ~ d*Education_W1
# Mediator effects - Income 
SumChron_W2 ~ e*LogIncome_W1 
mindbody_W3 ~ f*SumChron_W2
mindbody_W2 ~ g*LogIncome_W1
SumChron_W3 ~ h*mindbody_W2
# Mediator effects - Education
mindbody_W2 ~ i*Education_W1
SumChron_W2 ~ j*Education_W1 
# Control for previous wave
mindbody_W3 ~ mindbody_W2
SumChron_W3 ~ SumChron_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
mindbody_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
mindbody_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
mindbody_W2 ~~ SumChron_W2
mindbody_W3 ~~ SumChron_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.mb.chron <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.mb.chron <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "mindbody_W2"
m[3, 2] <- "SumChron_W2"
m[1, 3] <- "mindbody_W3"
m[4, 3] <- "SumChron_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("mindbody_W3 ~ Education_W1" = .20, 
                      "SumChron_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             mindbody_W2 = "Mind Body W2",
                             SumChron_W2 = "Sum Chron W2", 
                             mindbody_W3 = "Mind Body W3",
                             SumChron_W3 = "Sum Chron W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-mb-chron, echo = FALSE, fig.cap="Path Model: SES, Mind-Body Medicine, and Chronic Conditions"}
# Create final plot
plot(path_dia5)
```

```{r de-mb-chron, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Mind-Body Medicine, and Chronic Conditions",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 
```

```{r create-ie-mb, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.mb <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.mb <- tab.IE.mb %>%
  slice(match(x, Path))
```

```{r ie-mb-chron, echo=FALSE}
tab.IE.mb %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Conditions \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Mind-Body Medicine \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Mind-Body Medicine \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Conditions \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Mind-Body Medicine \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Mind-Body Medicine \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", "Upper CI", "\\textit{p}-value", " ", "$\\beta$"),
               caption="Indirect and Total Effects: SES, Mind-Body Medicines, and Chronic Conditions") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()
```

```{r fit-mb-chron, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               caption="Fit Statistics: SES, Chronic Conditions, and Mind-Body Medicines Path Model",
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

# remove uppercase from variables
rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

# Run gsem
gsem(mindbody_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (mindbody_W3 <- logincome_W1 education_W1 sumchron_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W3 <- logincome_W1 education_W1 sumchron_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson)

regsave using mindbodychron, pval ci replace 

nlcom (_b[sumchron_W2:logincome_W1]*_b[mindbody_W3:sumchron_W2]) (_b[mindbody_W3:logincome_W1] + _b[sumchron_W2:logincome_W1]*_b[mindbody_W3:sumchron_W2]) (_b[mindbody_W2:logincome_W1]*_b[sumchron_W3:mindbody_W2]) (_b[sumchron_W3:logincome_W1] + _b[mindbody_W2:logincome_W1]*_b[sumchron_W3:mindbody_W2]) (_b[sumchron_W2:education_W1]*_b[mindbody_W3:sumchron_W2]) (_b[mindbody_W3:education_W1] + _b[sumchron_W2:education_W1]*_b[mindbody_W3:sumchron_W2]) (_b[mindbody_W2:education_W1]*_b[sumchron_W3:mindbody_W2]) (_b[sumchron_W3:education_W1] + _b[mindbody_W2:education_W1]*_b[sumchron_W3:mindbody_W2]), post

esttab using "iemindbodychron.csv", cells("b se p ci_l ci_u")  replace

```

```{r read-in-mindbody-chron-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed model/mindbodychron.dta")
mindbodychron <- read_dta(path)

# Convert to data frame
mindbodychron <- as.data.frame(mindbodychron)

# Add indicator column 
 
# Split name column into firstname and last name
mindbodychron <-  mindbodychron %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
mindbodychron <- subset(mindbodychron, select = -c(N) )
```

```{r de-gsem-mindbody-chron, echo = FALSE}
mindbodychron %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Mind-Body Medicines, and Chronic Conditions",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-mindbodychron-table, echo = FALSE}
# Import organized loadings table from excel
mindbodychron.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed Model/iemindbodychron.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
mindbodychron.table[] <- lapply(mindbodychron.table, gsub, pattern='=', replacement='')

# Remove last row 
mindbodychron.table <- head(mindbodychron.table, - 1) 

# Rename columns
mindbodychron.table <- mindbodychron.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
mindbodychron.table <- mindbodychron.table[-c(1,2), ]

# convert p-value to numeric
mindbodychron.table$`p-value` <- as.numeric(mindbodychron.table$`p-value`)

# Remove row names
rownames(mindbodychron.table) <- NULL
```

```{r ie-gsem-mindbody-chron, echo = FALSE}
mindbodychron.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Conditions \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Mind-Body Medicines \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Mind-Body Medicines \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Conditions \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Mind-Body Medicines \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Mind-Body Medicines \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Mind-Body Medicines, and Chronic Conditions") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Self-Reported Health 

#### SEM

```{r model-mb-srh, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
mindbody_W3 ~ a*LogIncome_W1 
SRH_W3 ~ b*LogIncome_W1
# Direct Effect - Education
mindbody_W3 ~ c*Education_W1
SRH_W3 ~ d*Education_W1
# Mediator effects - Income 
SRH_W2 ~ e*LogIncome_W1 
mindbody_W3 ~ f*SRH_W2
mindbody_W2 ~ g*LogIncome_W1
SRH_W3 ~ h*mindbody_W2
# Mediator effects - Education
mindbody_W2 ~ i*Education_W1
SRH_W2 ~ j*Education_W1 
# Control for previous wave
mindbody_W3 ~ mindbody_W2
SRH_W3 ~ SRH_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
mindbody_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
mindbody_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
mindbody_W2 ~~ SRH_W2
mindbody_W3 ~~ SRH_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.mb.SRH <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.mb.SRH <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)



m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "mindbody_W2"
m[3, 2] <- "SRH_W2"
m[1, 3] <- "mindbody_W3"
m[4, 3] <- "SRH_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("mindbody_W3 ~ Education_W1" = .20, 
                      "SRH_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             mindbody_W2 = "Mind Body W2",
                             SRH_W2 = "SRH W2", 
                             mindbody_W3 = "Mind Body W3",
                             SRH_W3 = "SRH W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))





```

```{r path-mb-srh, echo = FALSE, fig.cap="Path Model: SES, Mind-Body Medicines, and Self-Reported Health"}
# Create final plot
plot(path_dia5)
```

```{r de-mb-srh, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Mind-Body Medicines, Self-Reported Health",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-mb-srh, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.mb.srh <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.mb.srh <- tab.IE.mb.srh %>%
  slice(match(x, Path))
```

```{r ie-mb-srh, echo=FALSE}
tab.IE.totCams.srh %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Mind-Body Medicines, and Self-Reported Health",               
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()

```

```{r fit-mb-srh, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, booktabs=TRUE, caption="Fit Statistics: SES, Self-Reported Health, and Mind-Body Medicines Path Model",              
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM 

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(mindbody_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit) (mindbody_W3 <- logincome_W1 education_W1 srh_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W3 <- logincome_W1 education_W1 srh_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit)

regsave using mindbodysrh, pval ci replace

nlcom (_b[srh_W2:logincome_W1]*_b[mindbody_W3:srh_W2]) (_b[mindbody_W3:logincome_W1] + _b[srh_W2:logincome_W1]*_b[mindbody_W3:srh_W2]) (_b[mindbody_W2:logincome_W1]*_b[srh_W3:mindbody_W2]) (_b[srh_W3:logincome_W1] + _b[mindbody_W2:logincome_W1]*_b[srh_W3:mindbody_W2]) (_b[srh_W2:education_W1]*_b[mindbody_W3:srh_W2]) (_b[mindbody_W3:education_W1] + _b[srh_W2:education_W1]*_b[mindbody_W3:srh_W2]) (_b[mindbody_W2:education_W1]*_b[srh_W3:mindbody_W2]) (_b[srh_W3:education_W1] + _b[mindbody_W2:education_W1]*_b[srh_W3:mindbody_W2]), post

esttab using "iemindbodysrh.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-mb-srh-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/mindbodysrh.dta")
mindbodysrh <- read_dta(path)

# Convert to data frame
mindbodysrh <- as.data.frame(mindbodysrh)

# Add indicator column 
 
# Split name column into firstname and last name
mindbodysrh <-  mindbodysrh %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
mindbodysrh <- subset(mindbodysrh, select = -c(N) )

# Drop cut rows
mindbodysrh <- slice(mindbodysrh, 1:(n() - 8))
```

```{r de-gsem-mb-srh, echo = FALSE}
mindbodysrh %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Mind-Body Medicines, and Self-Reported Health",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iemindbodysrh-table, echo = FALSE}
# Import indirect and total effects table
iembsrh.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iemindbodysrh.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iembsrh.table[] <- lapply(iembsrh.table, gsub, pattern='=', replacement='')

# Remove last row 
iembsrh.table <- head(iembsrh.table, - 1) 

# Rename columns
iembsrh.table <- iembsrh.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iembsrh.table <- iembsrh.table[-c(1,2), ]

# convert p-value to numeric
iembsrh.table$`p-value` <- as.numeric(iembsrh.table$`p-value`)

# Remove row names
rownames(iembsrh.table) <- NULL
```

```{r ie-gsem-mb-srh, echo = FALSE}
iembsrh.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Self-Reported Health \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Mind-Body Medicines \U2192 Self-Reported Health")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Mind-Body Medicines, and Self-Reported Health") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

### Chronic Pain 

#### SEM

```{r model-mb-chronicpain, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
mindbody_W3 ~ a*LogIncome_W1 
ChronicPain_W3 ~ b*LogIncome_W1
# Direct Effect - Education
mindbody_W3 ~ c*Education_W1
ChronicPain_W3 ~ d*Education_W1
# Mediator effects - Income 
ChronicPain_W2 ~ e*LogIncome_W1 
mindbody_W3 ~ f*ChronicPain_W2
mindbody_W2 ~ g*LogIncome_W1
ChronicPain_W3 ~ h*mindbody_W2
# Mediator effects - Education
mindbody_W2 ~ i*Education_W1
ChronicPain_W2 ~ j*Education_W1 
# Control for previous wave
mindbody_W3 ~ mindbody_W2
ChronicPain_W3 ~ ChronicPain_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
mindbody_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
mindbody_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
mindbody_W2 ~~ ChronicPain_W2
mindbody_W3 ~~ ChronicPain_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.mb.chronicpain <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.mb.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "mindbody_W2"
m[3, 2] <- "ChronicPain_W2"
m[1, 3] <- "mindbody_W3"
m[4, 3] <- "ChronicPain_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("mindbody_W3 ~ Education_W1" = .20, 
                      "ChronicPain_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             mindbody_W2 = "Mind-Body Medicines W2",
                             ChronicPain_W2 = "Chronic Pain W2", 
                             mindbody_W3 = "Mind-Body Medicines W3",
                             ChronicPain_W3 = "Chronic Pain W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-mb-chronicpain, echo = FALSE, fig.cap="Path Model: SES, Mind-Body Medicines, and Chronic Pain"}
# Create final plot
plot(path_dia5)
```

```{r de-mb-chronicpain, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Mind-Body Medicines, and Chronic Pain",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-mb-chronicpain, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.mb.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.mb.chronicpain <- tab.IE.mb.chronicpain %>%
  slice(match(x, Path))
```

```{r ie-mb-chronicpain, echo=FALSE}
tab.IE.mb.chronicpain %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Pain \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Mind-Body Medicines \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Mind-Body Medicines \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Pain \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Mind-Body Medicines \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Mind-Body Medicines \U2192 Chronic Pain")) %>%  
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Mind-Body Medicines, and Chronic Pain",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-mb-chronicpain, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Pain, and Mind-Body Medicines Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(mindbody_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (mindbody_W3 <- logincome_W1 education_W1 chronicpain_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W3 <- logincome_W1 education_W1 chronicpain_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using mindbodychronicpain, pval ci replace

nlcom (_b[chronicpain_W2:logincome_W1]*_b[mindbody_W3:chronicpain_W2]) (_b[mindbody_W3:logincome_W1] + _b[chronicpain_W2:logincome_W1]*_b[mindbody_W3:chronicpain_W2]) (_b[mindbody_W2:logincome_W1]*_b[chronicpain_W3:mindbody_W2]) (_b[chronicpain_W3:logincome_W1] + _b[mindbody_W2:logincome_W1]*_b[chronicpain_W3:mindbody_W2]) (_b[chronicpain_W2:education_W1]*_b[mindbody_W3:chronicpain_W2]) (_b[mindbody_W3:education_W1] + _b[chronicpain_W2:education_W1]*_b[mindbody_W3:chronicpain_W2]) (_b[mindbody_W2:education_W1]*_b[chronicpain_W3:mindbody_W2]) (_b[chronicpain_W3:education_W1] + _b[mindbody_W2:education_W1]*_b[chronicpain_W3:mindbody_W2]), post

esttab using "iemindbodychronicpain.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-mb-chronicpain-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/mindbodychronicpain.dta")
mindbodychronicpain <- read_dta(path)

# Convert to data frame
mindbodychronicpain <- as.data.frame(mindbodychronicpain)

# Add indicator column 
 
# Split name column into firstname and last name
mindbodychronicpain <-  mindbodychronicpain %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
mindbodychronicpain <- subset(mindbodychronicpain, select = -c(N) )
```

```{r de-gsem-mb-chronicpain, echo = FALSE}
mindbodychronicpain %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Mind-Body Medicines, and Chronic Pain",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iemindbodychronicpain-table, echo = FALSE}
# Import indirect and total effects table
iemindbodychronicpain.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iemindbodychronicpain.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iemindbodychronicpain.table[] <- lapply(iemindbodychronicpain.table, gsub, pattern='=', replacement='')

# Remove last row 
iemindbodychronicpain.table <- head(iemindbodychronicpain.table, - 1) 

# Rename columns
iemindbodychronicpain.table <- iemindbodychronicpain.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iemindbodychronicpain.table <- iemindbodychronicpain.table[-c(1,2), ]

# convert p-value to numeric
iemindbodychronicpain.table$`p-value` <- as.numeric(iemindbodychronicpain.table$`p-value`)

# Remove row names
rownames(iemindbodychronicpain.table) <- NULL
```

```{r ie-gsem-mb-chronicpain, echo = FALSE}
iemindbodychronicpain.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Pain \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Mind-Body Medicine \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Mind-Body Medicine \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Pain \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Mind-Body Medicine \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Mind-Body Medicine \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Mind-Body Medicines, and Chronic Pain") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Depression and Anxiety

#### SEM 

```{r model-mb-dep, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
mindbody_W3 ~ a*LogIncome_W1 
DepAnx_W3 ~ b*LogIncome_W1
# Direct Effect - Education
mindbody_W3 ~ c*Education_W1
DepAnx_W3 ~ d*Education_W1
# Mediator effects - Income 
DepAnx_W2 ~ e*LogIncome_W1 
mindbody_W3 ~ f*DepAnx_W2
mindbody_W2 ~ g*LogIncome_W1
DepAnx_W3 ~ h*mindbody_W2
# Mediator effects - Education
mindbody_W2 ~ i*Education_W1
DepAnx_W2 ~ j*Education_W1 
# Control for previous wave
mindbody_W3 ~ mindbody_W2
DepAnx_W3 ~ DepAnx_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
mindbody_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
mindbody_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
mindbody_W2 ~~ DepAnx_W2
mindbody_W3 ~~ DepAnx_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.mb.dep <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.mb.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "mindbody_W2"
m[3, 2] <- "DepAnx_W2"
m[1, 3] <- "mindbody_W3"
m[4, 3] <- "DepAnx_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("mindbody_W3 ~ Education_W1" = .20, 
                      "DepAnx_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             mindbody_W2 = "Mind-Body Medicines W2",
                             DepAnx_W2 = "DepAnx W2", 
                             mindbody_W3 = "Mind-Body Medicines W3",
                             DepAnx_W3 = "DepAnx W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))
```

```{r path-mb-dep, echo = FALSE, fig.cap="Path Model: SES, Mind-Body Medicines, and Depression/Anxiety"}
# Create final plot
plot(path_dia5)
```

```{r de-mb-dep, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Mind-Body Medicines, and Depression/Anxiety",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-mb-dep, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.mb.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.mb.dep <- tab.IE.mb.dep %>%
  slice(match(x, Path))
```

```{r ie-mb-dep, echo=FALSE}
tab.IE.mb.dep %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Mind-Body Medicines \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Mind-Body Medicines \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Mind-Body Medicines")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Mind-Body Medicines \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Mind-Body Medicines \U2192 Depression/Anxiety")) %>%  
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Mind-Body Medicines, and Depression/Anxiety",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-mb-dep, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Depression/Anxiety, and Mind-Body Medicines Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3 Depression_W2 Depression_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3 depression_W2 depression_W3)

set seed 1234
gsem(mindbody_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (mindbody_W3 <- logincome_W1 education_W1 depanx_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W3 <- logincome_W1 education_W1 depanx_W2 mindbody_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using mindbodydepression, pval ci replace

nlcom (_b[depanx_W2:logincome_W1]*_b[mindbody_W3:depanx_W2]) (_b[mindbody_W3:logincome_W1] + _b[depanx_W2:logincome_W1]*_b[mindbody_W3:depanx_W2]) (_b[mindbody_W2:logincome_W1]*_b[depanx_W3:mindbody_W2]) (_b[depanx_W3:logincome_W1] + _b[mindbody_W2:logincome_W1]*_b[depanx_W3:mindbody_W2]) (_b[depanx_W2:education_W1]*_b[mindbody_W3:depanx_W2]) (_b[mindbody_W3:education_W1] + _b[depanx_W2:education_W1]*_b[mindbody_W3:depanx_W2]) (_b[mindbody_W2:education_W1]*_b[depanx_W3:mindbody_W2]) (_b[depanx_W3:education_W1] + _b[mindbody_W2:education_W1]*_b[depanx_W3:mindbody_W2]), post

esttab using "iemindbodydepression.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-mb-depression-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/mindbodydepression.dta")
mindbodydepression <- read_dta(path)

# Convert to data frame
mindbodydepression <- as.data.frame(mindbodydepression)

# Add indicator column 
 
# Split name column into firstname and last name
mindbodydepression <-  mindbodydepression %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column
mindbodydepression <- subset(mindbodydepression, select = -c(N) )
```

```{r de-gsem-mb-depression, echo = FALSE}
mindbodydepression %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Mind-Body Medicines, and Depression/Anxiety",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iemindbodydepression-table, echo = FALSE}
# Import indirect and total effects table
iemindbodydepression.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iemindbodydepression.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iemindbodydepression.table[] <- lapply(iemindbodydepression.table, gsub, pattern='=', replacement='')

# Remove last row 
iemindbodydepression.table <- head(iemindbodydepression.table, - 1) 

# Rename columns
iemindbodydepression.table <- iemindbodydepression.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iemindbodydepression.table <- iemindbodydepression.table[-c(1,2), ]

# convert p-value to numeric
iemindbodydepression.table$`p-value` <- as.numeric(iemindbodydepression.table$`p-value`)

# Remove row names
rownames(iemindbodydepression.table) <- NULL
```

```{r ie-gsem-mb-depression, echo = FALSE}
iemindbodydepression.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Mind-Body Medicine \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Mind-Body Medicine \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Mind-Body Medicine")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Mind-Body Medicine \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Mind-Body Medicine \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Mind-Body Medicines, and Depression/Anxiety") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

## Alternative Medical Systems

### Chronic Conditions

#### SEM

```{r model-altmed-chron, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
altmed_W3 ~ a*LogIncome_W1 
SumChron_W3 ~ b*LogIncome_W1
# Direct Effect - Education
altmed_W3 ~ c*Education_W1
SumChron_W3 ~ d*Education_W1
# Mediator effects - Income 
SumChron_W2 ~ e*LogIncome_W1 
altmed_W3 ~ f*SumChron_W2
altmed_W2 ~ g*LogIncome_W1
SumChron_W3 ~ h*altmed_W2
# Mediator effects - Education
altmed_W2 ~ i*Education_W1
SumChron_W2 ~ j*Education_W1 
# Control for previous wave
altmed_W3 ~ altmed_W2
SumChron_W3 ~ SumChron_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
altmed_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
altmed_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
altmed_W2 ~~ SumChron_W2
altmed_W3 ~~ SumChron_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.altmed.chron <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.altmed.chron <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "altmed_W2"
m[3, 2] <- "SumChron_W2"
m[1, 3] <- "altmed_W3"
m[4, 3] <- "SumChron_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("altmed_W3 ~ Education_W1" = .20, 
                      "SumChron_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             altmed_W2 = "Alt Med W2",
                             SumChron_W2 = "Sum Chron W2", 
                             altmed_W3 = "Alt Med W3",
                             SumChron_W3 = "Sum Chron W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))





```

```{r path-altmed-chron, echo = FALSE, fig.cap="Path Model: SES, Alternative Medicines, and Chronic Conditions"}
# Create final plot
plot(path_dia5)
```

```{r de-altmed-chron, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Alternative Medicines, Chronic Conditions",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()
```

```{r create-ie-altmed-chron, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.altmed <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.altmed <- tab.IE.altmed %>%
  slice(match(x, Path))
```

```{r ie-altmed-chron, echo=FALSE}
tab.IE.altmed %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Alternative Medicines")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Conditions \U2192 Alternative Medicines")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Alternative Medicines \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Alternative Medicines \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Alternative Medicines")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Conditions \U2192 Alternative Medicines")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Alternative Medicines \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Alternative Medicines \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Alternative Medicines, and Chronic Conditions",
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", "Upper CI",
                             "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()

```

```{r fit-altmed-chron, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Conditions, and Alternative Medicines Path Model", 
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(altmed_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (altmed_W3 <- logincome_W1 education_W1 sumchron_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W3 <- logincome_W1 education_W1 sumchron_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson)

regsave using altmedchron, pval ci replace 

nlcom (_b[sumchron_W2:logincome_W1]*_b[altmed_W3:sumchron_W2]) (_b[altmed_W3:logincome_W1] + _b[sumchron_W2:logincome_W1]*_b[altmed_W3:sumchron_W2]) (_b[altmed_W2:logincome_W1]*_b[sumchron_W3:altmed_W2]) (_b[sumchron_W3:logincome_W1] + _b[altmed_W2:logincome_W1]*_b[sumchron_W3:altmed_W2]) (_b[sumchron_W2:education_W1]*_b[altmed_W3:sumchron_W2]) (_b[altmed_W3:education_W1] + _b[sumchron_W2:education_W1]*_b[altmed_W3:sumchron_W2]) (_b[altmed_W2:education_W1]*_b[sumchron_W3:altmed_W2]) (_b[sumchron_W3:education_W1] + _b[altmed_W2:education_W1]*_b[sumchron_W3:altmed_W2]), post

esttab using "iealtmedchron.csv", cells("b se p ci_l ci_u")  replace

```

```{r read-in-altmed-chron-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed model/altmedchron.dta")
altmedchron <- read_dta(path)

# Convert to data frame
altmedchron <- as.data.frame(altmedchron)

# Add indicator column 
 
# Split name column into firstname and last name
altmedchron <-  altmedchron %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
altmedchron <- subset(altmedchron, select = -c(N) )
```

```{r de-gsem-altmed-chron, echo = FALSE}
altmedchron %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Alternative Medical Systems, and Chronic Conditions",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-altmedchron-table, echo = FALSE}
# Import organized loadings table from excel
altmedchron.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed Model/iealtmedchron.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
altmedchron.table[] <- lapply(altmedchron.table, gsub, pattern='=', replacement='')

# Remove last row 
altmedchron.table <- head(altmedchron.table, - 1) 

# Rename columns
altmedchron.table <- altmedchron.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
altmedchron.table <- altmedchron.table[-c(1,2), ]

# convert p-value to numeric
altmedchron.table$`p-value` <- as.numeric(altmedchron.table$`p-value`)

# Remove row names
rownames(altmedchron.table) <- NULL
```

```{r ie-gsem-altmed-chron, echo = FALSE}
altmedchron.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Conditions \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Conditions \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Chronic Conditions")) %>%  
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Alternative Medical Systems, and Chronic Conditions") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Self-Reported Health

#### SEM

```{r model-altmed-srh, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
altmed_W3 ~ a*LogIncome_W1 
SRH_W3 ~ b*LogIncome_W1
# Direct Effect - Education
altmed_W3 ~ c*Education_W1
SRH_W3 ~ d*Education_W1
# Mediator effects - Income 
SRH_W2 ~ e*LogIncome_W1 
altmed_W3 ~ f*SRH_W2
altmed_W2 ~ g*LogIncome_W1
SRH_W3 ~ h*altmed_W2
# Mediator effects - Education
altmed_W2 ~ i*Education_W1
SRH_W2 ~ j*Education_W1 
# Control for previous wave
altmed_W3 ~ altmed_W2
SRH_W3 ~ SRH_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
altmed_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
altmed_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
altmed_W2 ~~ SRH_W2
altmed_W3 ~~ SRH_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.altmed.SRH <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.altmed.SRH <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)



m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "altmed_W2"
m[3, 2] <- "SRH_W2"
m[1, 3] <- "altmed_W3"
m[4, 3] <- "SRH_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("altmed_W3 ~ Education_W1" = .20, 
                      "SRH_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             altmed_W2 = "Alt. Med. Systems W2",
                             SRH_W2 = "SRH W2", 
                             altmed_W3 = "Alt. Med. Systems W3",
                             SRH_W3 = "SRH W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))





```

```{r path-altmed-srh, echo = FALSE, fig.cap="Path Model: SES, Alternative Medical Systems, and Self-Reported Health"}
# Create final plot
plot(path_dia5)
```

```{r de-altmed-srh, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Alternative Medical Systems, and Self-Reported Health",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-altmed-srh, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.altmed.srh <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.altmed.srh <- tab.IE.altmed.srh %>%
  slice(match(x, Path))
```

```{r ie-altmed-srh, echo=FALSE}
tab.IE.altmed.srh %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Alternative Medical Systems, and Self-Reported Health",               
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()

```

```{r fit-altmed-srh, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, booktabs=TRUE, caption="Fit Statistics: SES, Self-Reported Health, and Alternative Medical Systems Path Model",              
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(altmed_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit) (altmed_W3 <- logincome_W1 education_W1 srh_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W3 <- logincome_W1 education_W1 srh_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit)

regsave using altmedsrh, pval ci replace

nlcom (_b[srh_W2:logincome_W1]*_b[altmed_W3:srh_W2]) (_b[altmed_W3:logincome_W1] + _b[srh_W2:logincome_W1]*_b[altmed_W3:srh_W2]) (_b[altmed_W2:logincome_W1]*_b[srh_W3:altmed_W2]) (_b[srh_W3:logincome_W1] + _b[altmed_W2:logincome_W1]*_b[srh_W3:altmed_W2]) (_b[srh_W2:education_W1]*_b[altmed_W3:srh_W2]) (_b[altmed_W3:education_W1] + _b[srh_W2:education_W1]*_b[altmed_W3:srh_W2]) (_b[altmed_W2:education_W1]*_b[srh_W3:altmed_W2]) (_b[srh_W3:education_W1] + _b[altmed_W2:education_W1]*_b[srh_W3:altmed_W2]), post

esttab using "iealtmedsrh.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-altmed-srh-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/altmedsrh.dta")
altmedsrh <- read_dta(path)

# Convert to data frame
altmedsrh <- as.data.frame(altmedsrh)

# Add indicator column 
 
# Split name column into firstname and last name
altmedsrh <-  altmedsrh %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
altmedsrh <- subset(altmedsrh, select = -c(N) )

# Drop cut rows
altmedsrh <- slice(altmedsrh, 1:(n() - 8))
```

```{r de-gsem-altmed-srh, echo = FALSE}
altmedsrh %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Alternative Medical Systems, and Self-Reported Health",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iealtmedsrh-table, echo = FALSE}
# Import indirect and total effects table
iealtmedsrh.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iealtmedsrh.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iealtmedsrh.table[] <- lapply(iealtmedsrh.table, gsub, pattern='=', replacement='')

# Remove last row 
iealtmedsrh.table <- head(iealtmedsrh.table, - 1) 

# Rename columns
iealtmedsrh.table <- iealtmedsrh.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iealtmedsrh.table <- iealtmedsrh.table[-c(1,2), ]

# convert p-value to numeric
iealtmedsrh.table$`p-value` <- as.numeric(iealtmedsrh.table$`p-value`)

# Remove row names
rownames(iealtmedsrh.table) <- NULL
```

```{r ie-gsem-altmed-srh, echo = FALSE}
iealtmedsrh.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Self-Reported Health \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Self-Reported Health")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Alternative Medical Systems, and Self-Reported Health") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

### High Blood Pressure

#### SEM 

```{r model-altmed-highbp, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
altmed_W3 ~ a*LogIncome_W1 
HighBP_W3 ~ b*LogIncome_W1
# Direct Effect - Education
altmed_W3 ~ c*Education_W1
HighBP_W3 ~ d*Education_W1
# Mediator effects - Income 
HighBP_W2 ~ e*LogIncome_W1 
altmed_W3 ~ f*HighBP_W2
altmed_W2 ~ g*LogIncome_W1
HighBP_W3 ~ h*altmed_W2
# Mediator effects - Education
altmed_W2 ~ i*Education_W1
HighBP_W2 ~ j*Education_W1 
# Control for previous wave
altmed_W3 ~ altmed_W2
HighBP_W3 ~ HighBP_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
altmed_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
HighBP_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
altmed_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
HighBP_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
altmed_W2 ~~ HighBP_W2
altmed_W3 ~~ HighBP_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.altmed.highbp <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.altmed.highbp <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "altmed_W2"
m[3, 2] <- "HighBP_W2"
m[1, 3] <- "altmed_W3"
m[4, 3] <- "HighBP_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("altmed_W3 ~ Education_W1" = .20, 
                      "HighBP_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             altmed_W2 = "Alt. Med. Systems W2",
                             HighBP_W2 = "High BP W2", 
                             altmed_W3 = "Alt. Med. Systems W3",
                             HighBP_W3 = "High BP W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```


```{r path-altmed-highbp, echo = FALSE, fig.cap="Path Model: SES, Alternative Medical Systems, and High Blood Pressure"}
# Create final plot
plot(path_dia5)
```

```{r de-altmed-highbp, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "HighBP_W2", "High BP Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HighBP_W3", "High BP Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HighBP_W2", "High BP Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HighBP_W3", "High BP Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Alternative Medical Systems, High Blood Pressure",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-altmed-highbp, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.altmed.highbp <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.altmed.highbp <- tab.IE.altmed.highbp %>%
  slice(match(x, Path))
```

```{r ie-altmed-highbp, echo=FALSE}
tab.IE.altmed.highbp %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%   
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Alternative Medical Systems, and High Blood Pressure",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-altmed-highbp, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, High Blood Pressure, and Alternative Medical Systems Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(altmed_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (highbp_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (altmed_W3 <- logincome_W1 education_W1 highbp_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (highbp_W3 <- logincome_W1 education_W1 highbp_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using altmedhighbp, pval ci replace

nlcom (_b[highbp_W2:logincome_W1]*_b[altmed_W3:highbp_W2]) (_b[altmed_W3:logincome_W1] + _b[highbp_W2:logincome_W1]*_b[altmed_W3:highbp_W2]) (_b[altmed_W2:logincome_W1]*_b[highbp_W3:altmed_W2]) (_b[highbp_W3:logincome_W1] + _b[altmed_W2:logincome_W1]*_b[highbp_W3:altmed_W2]) (_b[highbp_W2:education_W1]*_b[altmed_W3:highbp_W2]) (_b[altmed_W3:education_W1] + _b[highbp_W2:education_W1]*_b[altmed_W3:highbp_W2]) (_b[altmed_W2:education_W1]*_b[highbp_W3:altmed_W2]) (_b[highbp_W3:education_W1] + _b[altmed_W2:education_W1]*_b[highbp_W3:altmed_W2]), post

esttab using "iealtmedhighbp.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-altmed-highbp-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/altmedhighbp.dta")
altmedhighbp <- read_dta(path)

# Convert to data frame
altmedhighbp <- as.data.frame(altmedhighbp)

# Add indicator column 
 
# Split name column into firstname and last name
altmedhighbp <-  altmedhighbp %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
altmedhighbp <- subset(altmedhighbp, select = -c(N) )
```

```{r de-gsem-altmed-highbp, echo = FALSE}
altmedhighbp %>%
  mutate(Indicator = replace(Indicator, Indicator == "highbp_W2", "High Blood Pressure Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "highbp_W3", "High Blood Pressure Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "highbp_W2", "High Blood Pressure Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "highbp_W3", "High Blood Pressure Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Alternative Medical Systems, High Blood Pressure",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iealtmedhighbp-table, echo = FALSE}
# Import indirect and total effects table
iealtmedhighbp.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iealtmedhighbp.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iealtmedhighbp.table[] <- lapply(iealtmedhighbp.table, gsub, pattern='=', replacement='')

# Remove last row 
iealtmedhighbp.table <- head(iealtmedhighbp.table, - 1) 

# Rename columns
iealtmedhighbp.table <- iealtmedhighbp.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iealtmedhighbp.table <- iealtmedhighbp.table[-c(1,2), ]

# convert p-value to numeric
iealtmedhighbp.table$`p-value` <- as.numeric(iealtmedhighbp.table$`p-value`)

# Remove row names
rownames(iealtmedhighbp.table) <- NULL
```

```{r ie-gsem-altmed-highbp, echo = FALSE}
iealtmedhighbp.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 High Blood Pressure \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 High Blood Pressure")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Alternative Medical Systems, and High Blood Pressure") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Diabetes 

#### SEM

```{r model-altmed-diabetes, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
altmed_W3 ~ a*LogIncome_W1 
Diabetes_W3 ~ b*LogIncome_W1
# Direct Effect - Education
altmed_W3 ~ c*Education_W1
Diabetes_W3 ~ d*Education_W1
# Mediator effects - Income 
Diabetes_W2 ~ e*LogIncome_W1 
altmed_W3 ~ f*Diabetes_W2
altmed_W2 ~ g*LogIncome_W1
Diabetes_W3 ~ h*altmed_W2
# Mediator effects - Education
altmed_W2 ~ i*Education_W1
Diabetes_W2 ~ j*Education_W1 
# Control for previous wave
altmed_W3 ~ altmed_W2
Diabetes_W3 ~ Diabetes_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
altmed_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
Diabetes_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
altmed_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
Diabetes_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
altmed_W2 ~~ Diabetes_W2
altmed_W3 ~~ Diabetes_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.altmed.diabetes <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.altmed.diabetes <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "altmed_W2"
m[3, 2] <- "Diabetes_W2"
m[1, 3] <- "altmed_W3"
m[4, 3] <- "Diabetes_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("altmed_W3 ~ Education_W1" = .20, 
                      "Diabetes_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             altmed_W2 = "Alt. Med. Systems W2",
                             Diabetes_W2 = "Diabetes W2", 
                             altmed_W3 = "Alt. Med. Systems W3",
                             Diabetes_W3 = "Diabetes W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-altmed-diabetes, echo = FALSE, fig.cap="Path Model: SES, Alternative Medical Systems, and Diabetes"}
# Create final plot
plot(path_dia5)
```

```{r de-altmed-diabetes, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "Diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Altnerative Medical Systems, and Diabetes",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-altmed-diabetes, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.altmed.diabetes <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.altmed.diabetes <- tab.IE.altmed.diabetes %>%
  slice(match(x, Path))
```

```{r ie-altmed-diabetes, echo=FALSE}
tab.IE.altmed.diabetes %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%   
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Alternative Medical Systems, and Diabetes",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-altmed-diabetes, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Diabetes, and Alternative Medical Systems Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3)

set seed 1234

gsem(altmed_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (diabetes_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (altmed_W3 <- logincome_W1 education_W1 diabetes_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (diabetes_W3 <- logincome_W1 education_W1 diabetes_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using altmeddiabetes, pval ci replace

nlcom (_b[diabetes_W2:logincome_W1]*_b[altmed_W3:diabetes_W2]) (_b[altmed_W3:logincome_W1] + _b[diabetes_W2:logincome_W1]*_b[altmed_W3:diabetes_W2]) (_b[altmed_W2:logincome_W1]*_b[diabetes_W3:altmed_W2]) (_b[diabetes_W3:logincome_W1] + _b[altmed_W2:logincome_W1]*_b[diabetes_W3:altmed_W2]) (_b[diabetes_W2:education_W1]*_b[altmed_W3:diabetes_W2]) (_b[altmed_W3:education_W1] + _b[diabetes_W2:education_W1]*_b[altmed_W3:diabetes_W2]) (_b[altmed_W2:education_W1]*_b[diabetes_W3:altmed_W2]) (_b[diabetes_W3:education_W1] + _b[altmed_W2:education_W1]*_b[diabetes_W3:altmed_W2]), post

esttab using "iealtmeddiabetes.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-altmed-diabetes-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/altmeddiabetes.dta")
altmeddiabetes <- read_dta(path)

# Convert to data frame
altmeddiabetes <- as.data.frame(altmeddiabetes)

# Add indicator column 
 
# Split name column into firstname and last name
altmeddiabetes <-  altmeddiabetes %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
altmeddiabetes <- subset(altmeddiabetes, select = -c(N) )
```

```{r de-gsem-altmed-diabetes, echo = FALSE}
altmeddiabetes %>%
  mutate(Indicator = replace(Indicator, Indicator == "diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "diabetes_W2", "Diabetes Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "diabetes_W3", "Diabetes Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Alternative Medical Systems, and Diabetes",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iealtmeddiabetes-table, echo = FALSE}
# Import indirect and total effects table
iealtmeddiabetes.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iealtmeddiabetes.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iealtmeddiabetes.table[] <- lapply(iealtmeddiabetes.table, gsub, pattern='=', replacement='')

# Remove last row 
iealtmeddiabetes.table <- head(iealtmeddiabetes.table, - 1) 

# Rename columns
iealtmeddiabetes.table <- iealtmeddiabetes.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iealtmeddiabetes.table <- iealtmeddiabetes.table[-c(1,2), ]

# convert p-value to numeric
iealtmeddiabetes.table$`p-value` <- as.numeric(iealtmeddiabetes.table$`p-value`)

# Remove row names
rownames(iealtmeddiabetes.table) <- NULL
```

```{r ie-gsem-altmed-diabetes, echo = FALSE}
iealtmeddiabetes.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Diabetes \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Diabetes")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Alternative Medical Systems, and Diabetes") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```


### Chronic Pain 

#### SEM

```{r model-altmed-chronicpain, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
altmed_W3 ~ a*LogIncome_W1 
ChronicPain_W3 ~ b*LogIncome_W1
# Direct Effect - Education
altmed_W3 ~ c*Education_W1
ChronicPain_W3 ~ d*Education_W1
# Mediator effects - Income 
ChronicPain_W2 ~ e*LogIncome_W1 
altmed_W3 ~ f*ChronicPain_W2
altmed_W2 ~ g*LogIncome_W1
ChronicPain_W3 ~ h*altmed_W2
# Mediator effects - Education
altmed_W2 ~ i*Education_W1
ChronicPain_W2 ~ j*Education_W1 
# Control for previous wave
altmed_W3 ~ altmed_W2
ChronicPain_W3 ~ ChronicPain_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
altmed_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
altmed_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
altmed_W2 ~~ ChronicPain_W2
altmed_W3 ~~ ChronicPain_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.altmed.chronicpain <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.altmed.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "altmed_W2"
m[3, 2] <- "ChronicPain_W2"
m[1, 3] <- "altmed_W3"
m[4, 3] <- "ChronicPain_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("altmed_W3 ~ Education_W1" = .20, 
                      "ChronicPain_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             altmed_W2 = "Alt. Med. Systems W2",
                             ChronicPain_W2 = "Chronic Pain W2", 
                             altmed_W3 = "Alt. Med. Systems W3",
                             ChronicPain_W3 = "Chronic Pain W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-altmed-chronicpain, echo = FALSE, fig.cap="Path Model: SES, Alternative Medical Systems, and Chronic Pain"}
# Create final plot
plot(path_dia5)
```

```{r de-altmed-chronicpain, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Alternative Medical Systems, and Chronic Pain",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-altmed-chronicpain, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.altmed.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.altmed.chronicpain <- tab.IE.altmed.chronicpain %>%
  slice(match(x, Path))
```

```{r ie-altmed-chronicpain, echo=FALSE}
tab.IE.altmed.chronicpain %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Alternative Medical Systems, and Chronic Pain",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-altmed-chronicpain, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Pain, and Alternative Medicines Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(altmed_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (altmed_W3 <- logincome_W1 education_W1 chronicpain_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W3 <- logincome_W1 education_W1 chronicpain_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using altmedchronicpain, pval ci replace

nlcom (_b[chronicpain_W2:logincome_W1]*_b[altmed_W3:chronicpain_W2]) (_b[altmed_W3:logincome_W1] + _b[chronicpain_W2:logincome_W1]*_b[altmed_W3:chronicpain_W2]) (_b[altmed_W2:logincome_W1]*_b[chronicpain_W3:altmed_W2]) (_b[chronicpain_W3:logincome_W1] + _b[altmed_W2:logincome_W1]*_b[chronicpain_W3:altmed_W2]) (_b[chronicpain_W2:education_W1]*_b[altmed_W3:chronicpain_W2]) (_b[altmed_W3:education_W1] + _b[chronicpain_W2:education_W1]*_b[altmed_W3:chronicpain_W2]) (_b[altmed_W2:education_W1]*_b[chronicpain_W3:altmed_W2]) (_b[chronicpain_W3:education_W1] + _b[altmed_W2:education_W1]*_b[chronicpain_W3:altmed_W2]), post

esttab using "iealtmedchronicpain.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-altmed-chronicpain-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/altmedchronicpain.dta")
altmedchronicpain <- read_dta(path)

# Convert to data frame
altmedchronicpain <- as.data.frame(altmedchronicpain)

# Add indicator column 
 
# Split name column into firstname and last name
altmedchronicpain <-  altmedchronicpain %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
altmedchronicpain <- subset(altmedchronicpain, select = -c(N) )
```

```{r de-gsem-altmed-chronicpain, echo = FALSE}
altmedchronicpain %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Alternative Medical Systems, and Chronic Pain",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iealtmedchronicpain-table, echo = FALSE}
# Import indirect and total effects table
iealtmedchronicpain.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iealtmedchronicpain.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iealtmedchronicpain.table[] <- lapply(iealtmedchronicpain.table, gsub, pattern='=', replacement='')

# Remove last row 
iealtmedchronicpain.table <- head(iealtmedchronicpain.table, - 1) 

# Rename columns
iealtmedchronicpain.table <- iealtmedchronicpain.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iealtmedchronicpain.table <- iealtmedchronicpain.table[-c(1,2), ]

# convert p-value to numeric
iealtmedchronicpain.table$`p-value` <- as.numeric(iealtmedchronicpain.table$`p-value`)

# Remove row names
rownames(iealtmedchronicpain.table) <- NULL
```

```{r ie-gsem-altmed-chronicpain, echo = FALSE}
iealtmedchronicpain.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Pain \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Alternative Medical Systems, and Chronic Pain") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Depression and Anxiety 

#### SEM

```{r model-altmed-dep, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
altmed_W3 ~ a*LogIncome_W1 
DepAnx_W3 ~ b*LogIncome_W1
# Direct Effect - Education
altmed_W3 ~ c*Education_W1
DepAnx_W3 ~ d*Education_W1
# Mediator effects - Income 
DepAnx_W2 ~ e*LogIncome_W1 
altmed_W3 ~ f*DepAnx_W2
altmed_W2 ~ g*LogIncome_W1
DepAnx_W3 ~ h*altmed_W2
# Mediator effects - Education
altmed_W2 ~ i*Education_W1
DepAnx_W2 ~ j*Education_W1 
# Control for previous wave
altmed_W3 ~ altmed_W2
DepAnx_W3 ~ DepAnx_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
altmed_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
altmed_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
altmed_W2 ~~ DepAnx_W2
altmed_W3 ~~ DepAnx_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.altmed.dep <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.altmed.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "altmed_W2"
m[3, 2] <- "DepAnx_W2"
m[1, 3] <- "altmed_W3"
m[4, 3] <- "DepAnx_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("altmed_W3 ~ Education_W1" = .20, 
                      "DepAnx_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             altmed_W2 = "Alt. Med. Systems W2",
                             DepAnx_W2 = "DepAnx W2", 
                             altmed_W3 = "Alt. Med. Systems W3",
                             DepAnx_W3 = "DepAnx W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-altmed-dep, echo = FALSE, fig.cap="Path Model: SES, Alternative Medical Systems, and Depression/Anxiety"}
# Create final plot
plot(path_dia5)
```

```{r de-altmed-dep, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Alternative Medical Systems, and Depression/Anxiety",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-altmed-dep, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.altmed.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.altmed.dep <- tab.IE.altmed.dep %>%
  slice(match(x, Path))
```

```{r ie-altmed-dep, echo=FALSE}
tab.IE.altmed.dep %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%   
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Alternative Medical Systems, and Depression/Anxiety",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-altmed-dep, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Depression/Anxiety, and Alternative Medical Systems Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3 Depression_W2 Depression_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3 depression_W2 depression_W3)

set seed 1234
gsem(altmed_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (altmed_W3 <- logincome_W1 education_W1 depanx_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W3 <- logincome_W1 education_W1 depanx_W2 altmed_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using altmeddepression, pval ci replace

nlcom (_b[depanx_W2:logincome_W1]*_b[altmed_W3:depanx_W2]) (_b[altmed_W3:logincome_W1] + _b[depanx_W2:logincome_W1]*_b[altmed_W3:depanx_W2]) (_b[altmed_W2:logincome_W1]*_b[depanx_W3:altmed_W2]) (_b[depanx_W3:logincome_W1] + _b[altmed_W2:logincome_W1]*_b[depanx_W3:altmed_W2]) (_b[depanx_W2:education_W1]*_b[altmed_W3:depanx_W2]) (_b[altmed_W3:education_W1] + _b[depanx_W2:education_W1]*_b[altmed_W3:depanx_W2]) (_b[altmed_W2:education_W1]*_b[depanx_W3:altmed_W2]) (_b[depanx_W3:education_W1] + _b[altmed_W2:education_W1]*_b[depanx_W3:altmed_W2]), post

esttab using "iealtmeddepression.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-altmed-depression-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/altmeddepression.dta")
altmeddepression <- read_dta(path)

# Convert to data frame
altmeddepression <- as.data.frame(altmeddepression)

# Add indicator column 
 
# Split name column into firstname and last name
altmeddepression <-  altmeddepression %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
altmeddepression <- subset(altmeddepression, select = -c(N) )

```

```{r de-gsem-altmed-depression, echo = FALSE}
altmeddepression %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Alternative Medical Systems, and Depression/Anxiety",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iealtmeddepression-table, echo = FALSE}
# Import indirect and total effects table
iealtmeddepression.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iealtmeddepression.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iealtmeddepression.table[] <- lapply(iealtmeddepression.table, gsub, pattern='=', replacement='')

# Remove last row 
iealtmeddepression.table <- head(iealtmeddepression.table, - 1) 

# Rename columns
iealtmeddepression.table <- iealtmeddepression.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iealtmeddepression.table <- iealtmeddepression.table[-c(1,2), ]

# convert p-value to numeric
iealtmeddepression.table$`p-value` <- as.numeric(iealtmeddepression.table$`p-value`)

# Remove row names
rownames(iealtmeddepression.table) <- NULL
```

```{r ie-gsem-altmed-depression, echo = FALSE}
iealtmeddepression.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Alternative Medical Systems")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Alternative Medical Systems \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Alternative Medical Systems, and Depression/Anxiety") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

## Physical and Nutritional Approaches

### Chronic Conditions 

#### SEM

```{r model-pna-chron, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
pna_W3 ~ a*LogIncome_W1 
SumChron_W3 ~ b*LogIncome_W1
# Direct Effect - Education
pna_W3 ~ c*Education_W1
SumChron_W3 ~ d*Education_W1
# Mediator effects - Income 
SumChron_W2 ~ e*LogIncome_W1 
pna_W3 ~ f*SumChron_W2
pna_W2 ~ g*LogIncome_W1
SumChron_W3 ~ h*pna_W2
# Mediator effects - Education
pna_W2 ~ i*Education_W1
SumChron_W2 ~ j*Education_W1 
# Control for previous wave
pna_W3 ~ pna_W2
SumChron_W3 ~ SumChron_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
pna_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
pna_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
pna_W2 ~~ SumChron_W2
pna_W3 ~~ SumChron_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.pna.chron <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.pna.chron <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "pna_W2"
m[3, 2] <- "SumChron_W2"
m[1, 3] <- "pna_W3"
m[4, 3] <- "SumChron_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("pna_W3 ~ Education_W1" = .20, 
                      "SumChron_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             pna_W2 = "PNA W2",
                             SumChron_W2 = "Sum Chron W2", 
                             pna_W3 = "PNA W3",
                             SumChron_W3 = "Sum Chron W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))





```

```{r path-pna-chron, echo = FALSE, fig.cap="Path Model: SES, Alternative Medicines, and Chronic Conditions"}
# Create final plot
plot(path_dia5)
```

```{r de-pna-chron, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Physical and Nutritional Approaches, Chronic Conditions",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-pna-chron, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.pna <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.pna <- tab.IE.pna %>%
  slice(match(x, Path))
```

```{r ie-pna-chron, echo=FALSE}
tab.IE.pna %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Chronic Conditions",
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", "Upper CI",
                             "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()
```

```{r fit-pna-chron, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Conditions, and Physical and Nutritional Approaches Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", 
                           "CFI", "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(pna_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (pna_W3 <- logincome_W1 education_W1 sumchron_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W3 <- logincome_W1 education_W1 sumchron_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson)

regsave using pnachron, pval ci replace

nlcom (_b[sumchron_W2:logincome_W1]*_b[pna_W3:sumchron_W2]) (_b[pna_W3:logincome_W1] + _b[sumchron_W2:logincome_W1]*_b[pna_W3:sumchron_W2]) (_b[pna_W2:logincome_W1]*_b[sumchron_W3:pna_W2]) (_b[sumchron_W3:logincome_W1] + _b[pna_W2:logincome_W1]*_b[sumchron_W3:pna_W2]) (_b[sumchron_W2:education_W1]*_b[pna_W3:sumchron_W2]) (_b[pna_W3:education_W1] + _b[sumchron_W2:education_W1]*_b[pna_W3:sumchron_W2]) (_b[pna_W2:education_W1]*_b[sumchron_W3:pna_W2]) (_b[sumchron_W3:education_W1] + _b[pna_W2:education_W1]*_b[sumchron_W3:pna_W2]), post

esttab using "iepnachron.csv", cells("b se p ci_l ci_u")  replace

```

```{r read-in-pna-chron-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed model/pnachron.dta")
pnachron <- read_dta(path)

# Convert to data frame
pnachron <- as.data.frame(pnachron)

# Add indicator column 
 
# Split name column into firstname and last name
pnachron <-  pnachron %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
pnachron <- subset(pnachron, select = -c(N) )
```

```{r de-gsem-pna-chron, echo = FALSE}
pnachron %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Physical and Nutritional Approaches, and Chronic Conditions",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-pnachron-table, echo = FALSE}
# Import organized loadings table from excel
pnachron.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed Model/iepnachron.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
pnachron.table[] <- lapply(pnachron.table, gsub, pattern='=', replacement='')

# Remove last row 
pnachron.table <- head(pnachron.table, - 1) 

# Rename columns
pnachron.table <- pnachron.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
pnachron.table <- pnachron.table[-c(1,2), ]

# convert p-value to numeric
pnachron.table$`p-value` <- as.numeric(pnachron.table$`p-value`)

# Remove row names
rownames(pnachron.table) <- NULL
```

```{r ie-gsem-pna-chron, echo = FALSE}
pnachron.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Conditions \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Chronic Conditions") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Self-Reported Health 

#### SEM

```{r model-pna-srh, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
pna_W3 ~ a*LogIncome_W1 
SRH_W3 ~ b*LogIncome_W1
# Direct Effect - Education
pna_W3 ~ c*Education_W1
SRH_W3 ~ d*Education_W1
# Mediator effects - Income 
SRH_W2 ~ e*LogIncome_W1 
pna_W3 ~ f*SRH_W2
pna_W2 ~ g*LogIncome_W1
SRH_W3 ~ h*pna_W2
# Mediator effects - Education
pna_W2 ~ i*Education_W1
SRH_W2 ~ j*Education_W1 
# Control for previous wave
pna_W3 ~ pna_W2
SRH_W3 ~ SRH_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
pna_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
pna_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
pna_W2 ~~ SRH_W2
pna_W3 ~~ SRH_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.pna.SRH <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.pna.SRH <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)



m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "pna_W2"
m[3, 2] <- "SRH_W2"
m[1, 3] <- "pna_W3"
m[4, 3] <- "SRH_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("pna_W3 ~ Education_W1" = .20, 
                      "SRH_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             pna_W2 = "PNA W2",
                             SRH_W2 = "SRH W2", 
                             pna_W3 = "PNA W3",
                             SRH_W3 = "SRH W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))





```

```{r path-pna-srh, echo = FALSE, fig.cap="Path Model: SES, Physical and Nutritional Approaches, and Self-Reported Health"}
# Create final plot
plot(path_dia5)
```

```{r de-pna-srh, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Physical and Nutritional Approaches, and Self-Reported Health",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-pna-srh, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.pna.srh <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.pna.srh <- tab.IE.pna.srh %>%
  slice(match(x, Path))
```

```{r ie-pna-srh, echo=FALSE}
tab.IE.pna.srh %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Self-Reported Health",               
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()

```

```{r fit-pna-srh, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, booktabs=TRUE, caption="Fit Statistics: SES, Self-Reported Health, and Physical and Nutritional Approaches Path Model",              
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(pna_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit) (pna_W3 <- logincome_W1 education_W1 srh_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W3 <- logincome_W1 education_W1 srh_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit)

regsave using pnasrh, pval ci replace

nlcom (_b[srh_W2:logincome_W1]*_b[pna_W3:srh_W2]) (_b[pna_W3:logincome_W1] + _b[srh_W2:logincome_W1]*_b[pna_W3:srh_W2]) (_b[pna_W2:logincome_W1]*_b[srh_W3:pna_W2]) (_b[srh_W3:logincome_W1] + _b[pna_W2:logincome_W1]*_b[srh_W3:pna_W2]) (_b[srh_W2:education_W1]*_b[pna_W3:srh_W2]) (_b[pna_W3:education_W1] + _b[srh_W2:education_W1]*_b[pna_W3:srh_W2]) (_b[pna_W2:education_W1]*_b[srh_W3:pna_W2]) (_b[srh_W3:education_W1] + _b[pna_W2:education_W1]*_b[srh_W3:pna_W2]), post

esttab using "iepnasrh.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-pna-srh-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/pnasrh.dta")
pnasrh <- read_dta(path)

# Convert to data frame
pnasrh <- as.data.frame(pnasrh)

# Add indicator column 
 
# Split name column into firstname and last name
pnasrh <-  pnasrh %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
pnasrh <- subset(pnasrh, select = -c(N) )

# Drop cut rows
pnasrh <- slice(pnasrh, 1:(n() - 8))
```

```{r de-gsem-pna-srh, echo = FALSE}
pnasrh %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Physical and Nutritional Approaches, and Self-Reported Health",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iepnasrh-table, echo = FALSE}
# Import indirect and total effects table
iepnasrh.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iepnasrh.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iepnasrh.table[] <- lapply(iepnasrh.table, gsub, pattern='=', replacement='')

# Remove last row 
iepnasrh.table <- head(iepnasrh.table, - 1) 

# Rename columns
iepnasrh.table <- iepnasrh.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iepnasrh.table <- iepnasrh.table[-c(1,2), ]

# convert p-value to numeric
iepnasrh.table$`p-value` <- as.numeric(iepnasrh.table$`p-value`)

# Remove row names
rownames(iepnasrh.table) <- NULL
```

```{r ie-gsem-pna-srh, echo = FALSE}
iepnasrh.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Self-Reported Health \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Self-Reported Health")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Self-Reported Health") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### High Blood Pressure

#### SEM

```{r model-pna-highbp, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
pna_W3 ~ a*LogIncome_W1 
HighBP_W3 ~ b*LogIncome_W1
# Direct Effect - Education
pna_W3 ~ c*Education_W1
HighBP_W3 ~ d*Education_W1
# Mediator effects - Income 
HighBP_W2 ~ e*LogIncome_W1 
pna_W3 ~ f*HighBP_W2
pna_W2 ~ g*LogIncome_W1
HighBP_W3 ~ h*pna_W2
# Mediator effects - Education
pna_W2 ~ i*Education_W1
HighBP_W2 ~ j*Education_W1 
# Control for previous wave
pna_W3 ~ pna_W2
HighBP_W3 ~ HighBP_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
pna_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
HighBP_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
pna_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
HighBP_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
pna_W2 ~~ HighBP_W2
pna_W3 ~~ HighBP_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.pna.highbp <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.pna.highbp <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "pna_W2"
m[3, 2] <- "HighBP_W2"
m[1, 3] <- "pna_W3"
m[4, 3] <- "HighBP_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("pna_W3 ~ Education_W1" = .20, 
                      "HighBP_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             pna_W2 = "PNA W2",
                             HighBP_W2 = "High BP W2", 
                             pna_W3 = "PNA W3",
                             HighBP_W3 = "High BP W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-pna-highbp, echo = FALSE, fig.cap="Path Model: SES, Physical and Nutritional Approaches, and High Blood Pressure"}
# Create final plot
plot(path_dia5)
```

```{r de-pna-highbp, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "HighBP_W2", "High BP Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HighBP_W3", "High BP Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HighBP_W2", "High BP Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HighBP_W3", "High BP Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Physical and Nutritional Approaches, High Blood Pressure",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-pna-highbp, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.pna.highbp <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.pna.highbp <- tab.IE.pna.highbp %>%
  slice(match(x, Path))
```

```{r ie-pna-highbp, echo=FALSE}
tab.IE.pna.highbp %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%   
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Physical and Nutritional Approaches, and High Blood Pressure",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-pna-highbp, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, High Blood Pressure, and Physical and Nutritional Approaches Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(pna_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (highbp_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (pna_W3 <- logincome_W1 education_W1 highbp_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (highbp_W3 <- logincome_W1 education_W1 highbp_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using pnahighbp, pval ci replace

nlcom (_b[highbp_W2:logincome_W1]*_b[pna_W3:highbp_W2]) (_b[pna_W3:logincome_W1] + _b[highbp_W2:logincome_W1]*_b[pna_W3:highbp_W2]) (_b[pna_W2:logincome_W1]*_b[highbp_W3:pna_W2]) (_b[highbp_W3:logincome_W1] + _b[pna_W2:logincome_W1]*_b[highbp_W3:pna_W2]) (_b[highbp_W2:education_W1]*_b[pna_W3:highbp_W2]) (_b[pna_W3:education_W1] + _b[highbp_W2:education_W1]*_b[pna_W3:highbp_W2]) (_b[pna_W2:education_W1]*_b[highbp_W3:pna_W2]) (_b[highbp_W3:education_W1] + _b[pna_W2:education_W1]*_b[highbp_W3:pna_W2]), post

esttab using "iepnahighbp.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-pna-highbp-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/pnahighbp.dta")
pnahighbp <- read_dta(path)

# Convert to data frame
pnahighbp <- as.data.frame(pnahighbp)

# Add indicator column 
 
# Split name column into firstname and last name
pnahighbp <-  pnahighbp %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
pnahighbp <- subset(pnahighbp, select = -c(N) )
```

```{r de-gsem-pna-highbp, echo = FALSE}
pnahighbp %>%
  mutate(Indicator = replace(Indicator, Indicator == "highbp_W2", "High Blood Pressure Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "highbp_W3", "High Blood Pressure Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "highbp_W2", "High Blood Pressure Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "highbp_W3", "High Blood Pressure Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Physical and Nutritional Approaches, High Blood Pressure",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iepnahighbp-table, echo = FALSE}
# Import indirect and total effects table
iepnahighbp.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iealtmedhighbp.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iepnahighbp.table[] <- lapply(iepnahighbp.table, gsub, pattern='=', replacement='')

# Remove last row 
iepnahighbp.table <- head(iepnahighbp.table, - 1) 

# Rename columns
iepnahighbp.table <- iepnahighbp.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iepnahighbp.table <- iepnahighbp.table[-c(1,2), ]

# convert p-value to numeric
iepnahighbp.table$`p-value` <- as.numeric(iepnahighbp.table$`p-value`)

# Remove row names
rownames(iepnahighbp.table) <- NULL
```

```{r ie-gsem-pna-highbp, echo = FALSE}
iepnahighbp.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 High Blood Pressure \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 High Blood Pressure")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Physical and Nutritional Approaches, and High Blood Pressure") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Chronic Pain 

#### SEM

```{r model-pna-chronicpain, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
pna_W3 ~ a*LogIncome_W1 
ChronicPain_W3 ~ b*LogIncome_W1
# Direct Effect - Education
pna_W3 ~ c*Education_W1
ChronicPain_W3 ~ d*Education_W1
# Mediator effects - Income 
ChronicPain_W2 ~ e*LogIncome_W1 
pna_W3 ~ f*ChronicPain_W2
pna_W2 ~ g*LogIncome_W1
ChronicPain_W3 ~ h*pna_W2
# Mediator effects - Education
pna_W2 ~ i*Education_W1
ChronicPain_W2 ~ j*Education_W1 
# Control for previous wave
pna_W3 ~ pna_W2
ChronicPain_W3 ~ ChronicPain_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
pna_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
pna_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
pna_W2 ~~ ChronicPain_W2
pna_W3 ~~ ChronicPain_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.pna.chronicpain <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.pna.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "pna_W2"
m[3, 2] <- "ChronicPain_W2"
m[1, 3] <- "pna_W3"
m[4, 3] <- "ChronicPain_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("pna_W3 ~ Education_W1" = .20, 
                      "ChronicPain_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             pna_W2 = "PNA W2",
                             ChronicPain_W2 = "Chronic Pain W2", 
                             pna_W3 = "PNA W3",
                             ChronicPain_W3 = "Chronic Pain W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-pna-chronicpain, echo = FALSE, fig.cap="Path Model: SES, Physical and Nutritional Systems, and Chronic Pain"}
# Create final plot
plot(path_dia5)
```

```{r de-pna-chronicpain, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Physical and Nutritional Approaches, and Chronic Pain",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-pna-chronicpain, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.pna.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.pna.chronicpain <- tab.IE.pna.chronicpain %>%
  slice(match(x, Path))
```

```{r ie-pna-chronicpain, echo=FALSE}
tab.IE.pna.chronicpain %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Chronic Pain",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-pna-chronicpain, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Pain, and Physical and Nutritional Approaches Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(pna_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (pna_W3 <- logincome_W1 education_W1 chronicpain_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W3 <- logincome_W1 education_W1 chronicpain_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using pnachronicpain, pval ci replace

nlcom (_b[chronicpain_W2:logincome_W1]*_b[pna_W3:chronicpain_W2]) (_b[pna_W3:logincome_W1] + _b[chronicpain_W2:logincome_W1]*_b[pna_W3:chronicpain_W2]) (_b[pna_W2:logincome_W1]*_b[chronicpain_W3:pna_W2]) (_b[chronicpain_W3:logincome_W1] + _b[pna_W2:logincome_W1]*_b[chronicpain_W3:pna_W2]) (_b[chronicpain_W2:education_W1]*_b[pna_W3:chronicpain_W2]) (_b[pna_W3:education_W1] + _b[chronicpain_W2:education_W1]*_b[pna_W3:chronicpain_W2]) (_b[pna_W2:education_W1]*_b[chronicpain_W3:pna_W2]) (_b[chronicpain_W3:education_W1] + _b[pna_W2:education_W1]*_b[chronicpain_W3:pna_W2]), post

esttab using "iepnachronicpain.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-pna-chronicpain-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/pnachronicpain.dta")
pnachronicpain <- read_dta(path)

# Convert to data frame
pnachronicpain <- as.data.frame(pnachronicpain)

# Add indicator column 
 
# Split name column into firstname and last name
pnachronicpain <-  pnachronicpain %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
pnachronicpain <- subset(pnachronicpain, select = -c(N) )
```

```{r de-gsem-pna-chronicpain, echo = FALSE}
pnachronicpain %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Physical and Nutritional Approaches, and Chronic Pain",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iepnachronicpain-table, echo = FALSE}
# Import indirect and total effects table
iepnachronicpain.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iepnachronicpain.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iepnachronicpain.table[] <- lapply(iepnachronicpain.table, gsub, pattern='=', replacement='')

# Remove last row 
iepnachronicpain.table <- head(iepnachronicpain.table, - 1) 

# Rename columns
iepnachronicpain.table <- iepnachronicpain.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iepnachronicpain.table <- iepnachronicpain.table[-c(1,2), ]

# convert p-value to numeric
iepnachronicpain.table$`p-value` <- as.numeric(iepnachronicpain.table$`p-value`)

# Remove row names
rownames(iepnachronicpain.table) <- NULL
```

```{r ie-gsem-pna-chronicpain, echo = FALSE}
iepnachronicpain.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Pain \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Chronic Pain") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Depression/Anxiety 

#### SEM 

```{r model-pna-dep, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
pna_W3 ~ a*LogIncome_W1 
DepAnx_W3 ~ b*LogIncome_W1
# Direct Effect - Education
pna_W3 ~ c*Education_W1
DepAnx_W3 ~ d*Education_W1
# Mediator effects - Income 
DepAnx_W2 ~ e*LogIncome_W1 
pna_W3 ~ f*DepAnx_W2
pna_W2 ~ g*LogIncome_W1
DepAnx_W3 ~ h*pna_W2
# Mediator effects - Education
pna_W2 ~ i*Education_W1
DepAnx_W2 ~ j*Education_W1 
# Control for previous wave
pna_W3 ~ pna_W2
DepAnx_W3 ~ DepAnx_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
pna_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
pna_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
pna_W2 ~~ DepAnx_W2
pna_W3 ~~ DepAnx_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.pna.dep <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.pna.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "pna_W2"
m[3, 2] <- "DepAnx_W2"
m[1, 3] <- "pna_W3"
m[4, 3] <- "DepAnx_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("pna_W3 ~ Education_W1" = .20, 
                      "DepAnx_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             pna_W2 = "PNA W2",
                             DepAnx_W2 = "DepAnx W2", 
                             pna_W3 = "PNA W3",
                             DepAnx_W3 = "DepAnx W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))



```

```{r path-pna-dep, echo = FALSE, fig.cap="Path Model: SES, Physical and Nutritional Approaches, and Depression/Anxiety"}
# Create final plot
plot(path_dia5)
```

```{r de-pna-dep, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Physical and Nutritional Approaches, and Depression/Anxiety",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-pna-dep, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.pna.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.pna.dep <- tab.IE.pna.dep %>%
  slice(match(x, Path))
```

```{r ie-pna-dep, echo=FALSE}
tab.IE.pna.dep %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Depression/Anxiety",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-pna-dep, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Depression/Anxiety, and Physical and Nutritional Approaches Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3 Depression_W2 Depression_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3 depression_W2 depression_W3)

set seed 1234
gsem(pna_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (pna_W3 <- logincome_W1 education_W1 depanx_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W3 <- logincome_W1 education_W1 depanx_W2 pna_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using pnadepression, pval ci replace

nlcom (_b[depanx_W2:logincome_W1]*_b[pna_W3:depanx_W2]) (_b[pna_W3:logincome_W1] + _b[depanx_W2:logincome_W1]*_b[pna_W3:depanx_W2]) (_b[pna_W2:logincome_W1]*_b[depanx_W3:pna_W2]) (_b[depanx_W3:logincome_W1] + _b[pna_W2:logincome_W1]*_b[depanx_W3:pna_W2]) (_b[depanx_W2:education_W1]*_b[pna_W3:depanx_W2]) (_b[pna_W3:education_W1] + _b[depanx_W2:education_W1]*_b[pna_W3:depanx_W2]) (_b[pna_W2:education_W1]*_b[depanx_W3:pna_W2]) (_b[depanx_W3:education_W1] + _b[pna_W2:education_W1]*_b[depanx_W3:pna_W2]), post

esttab using "iepnadepression.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-pna-depression-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/pnadepression.dta")
pnadepression <- read_dta(path)

# Convert to data frame
pnadepression <- as.data.frame(pnadepression)

# Add indicator column 
 
# Split name column into firstname and last name
pnadepression <-  pnadepression %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
pnadepression <- subset(pnadepression, select = -c(N) )
```

```{r de-gsem-pna-depression, echo = FALSE}
pnadepression %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W3", "Depression/Anxety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Physical and Nutritional Approaches, and Depression/Anxiety",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iepnadepression-table, echo = FALSE}
# Import indirect and total effects table
iepnadepression.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iepnadepression.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iepnadepression.table[] <- lapply(iepnadepression.table, gsub, pattern='=', replacement='')

# Remove last row 
iepnadepression.table <- head(iepnadepression.table, - 1) 

# Rename columns
iepnadepression.table <- iepnadepression.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iepnadepression.table <- iepnadepression.table[-c(1,2), ]

# convert p-value to numeric
iepnadepression.table$`p-value` <- as.numeric(iepnadepression.table$`p-value`)

# Remove row names
rownames(iepnadepression.table) <- NULL
```

```{r ie-gsem-pna-depression, echo = FALSE}
iepnadepression.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 	Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Physical and Nutritional Approaches")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Physical and Nutritional Approaches \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Physical and Nutritional Approaches, and Depression/Anxiety") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

## Manipulative Treatments

### Chronic Conditions 

#### SEM

```{r model-manipulative-chron, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
manipulative_W3 ~ a*LogIncome_W1 
SumChron_W3 ~ b*LogIncome_W1
# Direct Effect - Education
manipulative_W3 ~ c*Education_W1
SumChron_W3 ~ d*Education_W1
# Mediator effects - Income 
SumChron_W2 ~ e*LogIncome_W1 
manipulative_W3 ~ f*SumChron_W2
manipulative_W2 ~ g*LogIncome_W1
SumChron_W3 ~ h*manipulative_W2
# Mediator effects - Education
manipulative_W2 ~ i*Education_W1
SumChron_W2 ~ j*Education_W1 
# Control for previous wave
manipulative_W3 ~ manipulative_W2
SumChron_W3 ~ SumChron_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
manipulative_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
manipulative_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SumChron_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
manipulative_W2 ~~ SumChron_W2
manipulative_W3 ~~ SumChron_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.manipulative.chron <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.manipulative.chron <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "manipulative_W2"
m[3, 2] <- "SumChron_W2"
m[1, 3] <- "manipulative_W3"
m[4, 3] <- "SumChron_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("manipulative_W3 ~ Education_W1" = .20, 
                      "SumChron_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             manipulative_W2 = "Manipulative W2",
                             SumChron_W2 = "Sum Chron W2", 
                             manipulative_W3 = "Manipulative W3",
                             SumChron_W3 = "Sum Chron W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))





```

```{r path-manipulative-chron, echo = FALSE, fig.cap="Path Model: SES,Manipulative Treatments, and Chronic Conditions"}
# Create final plot
plot(path_dia5)
```

```{r de-manipulative-chron, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Manipulative Treatments, Chronic Conditions",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 
```

```{r create-ie-manipulative-chron, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.manipulative <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.manipulative <- tab.IE.manipulative %>%
  slice(match(x, Path))
```

```{r ie-manipulative-chron, echo=FALSE}
tab.IE.manipulative %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Manipulative Treatments, and Chronic Conditions",              
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

```{r fit-manipulative-chron, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Conditions, and Manipulative Treatments Path Model", 
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(manipulative_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, poisson) (manipulative_W3 <- logincome_W1 education_W1 sumchron_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (sumchron_W3 <- logincome_W1 education_W1 sumchron_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, poisson)

regsave using manipulativechron, pval ci replace

nlcom (_b[sumchron_W2:logincome_W1]*_b[manipulative_W3:sumchron_W2]) (_b[manipulative_W3:logincome_W1] + _b[sumchron_W2:logincome_W1]*_b[manipulative_W3:sumchron_W2]) (_b[manipulative_W2:logincome_W1]*_b[sumchron_W3:manipulative_W2]) (_b[sumchron_W3:logincome_W1] + _b[manipulative_W2:logincome_W1]*_b[sumchron_W3:manipulative_W2]) (_b[sumchron_W2:education_W1]*_b[manipulative_W3:sumchron_W2]) (_b[manipulative_W3:education_W1] + _b[sumchron_W2:education_W1]*_b[manipulative_W3:sumchron_W2]) (_b[manipulative_W2:education_W1]*_b[sumchron_W3:manipulative_W2]) (_b[sumchron_W3:education_W1] + _b[manipulative_W2:education_W1]*_b[sumchron_W3:manipulative_W2]), post

esttab using "iemanipulativechron.csv", cells("b se p ci_l ci_u")  replace

```

```{r read-in-manipulative-chron-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed model/manipulativechron.dta")
manipulativechron <- read_dta(path)

# Convert to data frame
manipulativechron <- as.data.frame(manipulativechron)

# Add indicator column 
 
# Split name column into firstname and last name
manipulativechron <-  manipulativechron %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
manipulativechron <- subset(manipulativechron, select = -c(N) )
```

```{r de-gsem-manipulative-chron, echo = FALSE}
manipulativechron %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Manipulative Treatments, and Chronic Conditions",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-manipulativechron-table, echo = FALSE}
# Import organized loadings table from excel
manipulativechron.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed Model/iemanipulativechron.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
manipulativechron.table[] <- lapply(manipulativechron.table, gsub, pattern='=', replacement='')

# Remove last row 
manipulativechron.table <- head(manipulativechron.table, - 1) 

# Rename columns
manipulativechron.table <- manipulativechron.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
manipulativechron.table <- manipulativechron.table[-c(1,2), ]

# convert p-value to numeric
manipulativechron.table$`p-value` <- as.numeric(manipulativechron.table$`p-value`)

# Remove row names
rownames(manipulativechron.table) <- NULL
```

```{r ie-gsem-manipulative-chron, echo = FALSE}
manipulativechron.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Conditions \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Conditions")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Manipulative Treatments, and Chronic Conditions") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Self-Reported Health

#### SEM

```{r model-manipulative-SRH, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
manipulative_W3 ~ a*LogIncome_W1 
SRH_W3 ~ b*LogIncome_W1
# Direct Effect - Education
manipulative_W3 ~ c*Education_W1
SRH_W3 ~ d*Education_W1
# Mediator effects - Income 
SRH_W2 ~ e*LogIncome_W1 
manipulative_W3 ~ f*SRH_W2
manipulative_W2 ~ g*LogIncome_W1
SRH_W3 ~ h*manipulative_W2
# Mediator effects - Education
manipulative_W2 ~ i*Education_W1
SRH_W2 ~ j*Education_W1 
# Control for previous wave
manipulative_W3 ~ manipulative_W2
SRH_W3 ~ SRH_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
manipulative_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
manipulative_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
SRH_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
manipulative_W2 ~~ SRH_W2
manipulative_W3 ~~ SRH_W3
'


# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.manipulative.SRH <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.manipulative.SRH <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)

m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "manipulative_W2"
m[3, 2] <- "SRH_W2"
m[1, 3] <- "manipulative_W3"
m[4, 3] <- "SRH_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("manipulative_W3 ~ Education_W1" = .20, 
                      "SRH_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             manipulative_W2 = "Manipulative W2",
                             SRH_W2 = "SRH W2", 
                             manipulative_W3 = "Manipulative W3",
                             SRH_W3 = "SRH W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))
```

```{r path-manipulative-SRH, echo = FALSE, fig.cap="Path Model: SES, Manipulative Treatments, and Self-Reported Health"}
# Create final plot
plot(path_dia5)
```

```{r de-manipulative-SRH, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Manipulative Treatments, Self-Reported Health",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()
```

```{r create-ie-manipulative-SRH, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.manipulative.srh <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.manipulative.srh <- tab.IE.manipulative.srh %>%
  slice(match(x, Path))
```

```{r ie-manipulative-SRH, echo=FALSE}
tab.IE.manipulative.srh %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Manipulative Treatments, and Self-Reported Health",
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape()

```

```{r fit-manipulative-SRH, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Self-Reported Health, and Manipulative Treatments Path Model",
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

set seed 1234

gsem(manipulative_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit) (manipulative_W3 <- logincome_W1 education_W1 srh_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (srh_W3 <- logincome_W1 education_W1 srh_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, oprobit)

regsave using manipulativesrh, pval ci replace

nlcom (_b[srh_W2:logincome_W1]*_b[manipulative_W3:srh_W2]) (_b[manipulative_W3:logincome_W1] + _b[srh_W2:logincome_W1]*_b[manipulative_W3:srh_W2]) (_b[manipulative_W2:logincome_W1]*_b[srh_W3:manipulative_W2]) (_b[srh_W3:logincome_W1] + _b[manipulative_W2:logincome_W1]*_b[srh_W3:manipulative_W2]) (_b[srh_W2:education_W1]*_b[manipulative_W3:srh_W2]) (_b[manipulative_W3:education_W1] + _b[srh_W2:education_W1]*_b[manipulative_W3:srh_W2]) (_b[manipulative_W2:education_W1]*_b[srh_W3:manipulative_W2]) (_b[srh_W3:education_W1] + _b[manipulative_W2:education_W1]*_b[srh_W3:manipulative_W2]), post

esttab using "iemanipulativesrh.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-manipulative-srh-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/manipulativesrh.dta")
manipulativesrh <- read_dta(path)

# Convert to data frame
manipulativesrh <- as.data.frame(manipulativesrh)

# Add indicator column 
 
# Split name column into firstname and last name
manipulativesrh <-  manipulativesrh %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
manipulativesrh <- subset(manipulativesrh, select = -c(N) )

# Drop last rows 
manipulativesrh <- slice(manipulativesrh, 1:(n() - 8))
```

```{r de-gsem-manipulative-srh, echo = FALSE}
manipulativesrh %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Manipulative Treatments, and Self-Reported Health",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iemanipulativesrh-table, echo = FALSE}
# Import indirect and total effects table
iemanipulativesrh.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iemanipulativesrh.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iemanipulativesrh.table[] <- lapply(iemanipulativesrh.table, gsub, pattern='=', replacement='')

# Remove last row 
iemanipulativesrh.table <- head(iemanipulativesrh.table, - 1) 

# Rename columns
iemanipulativesrh.table <- iemanipulativesrh.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iemanipulativesrh.table <- iemanipulativesrh.table[-c(1,2), ]

# convert p-value to numeric
iemanipulativesrh.table$`p-value` <- as.numeric(iemanipulativesrh.table$`p-value`)

# Remove row names
rownames(iemanipulativesrh.table) <- NULL
```

```{r ie-gsem-manipulative-srh, echo = FALSE}
iemanipulativesrh.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Self-Reported Health \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Self-Reported Health")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Manipulative Treatments, and Self-Reported Health") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Chronic Pain

#### SEM

```{r model-manipulative-chronicpain, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
manipulative_W3 ~ a*LogIncome_W1 
ChronicPain_W3 ~ b*LogIncome_W1
# Direct Effect - Education
manipulative_W3 ~ c*Education_W1
ChronicPain_W3 ~ d*Education_W1
# Mediator effects - Income 
ChronicPain_W2 ~ e*LogIncome_W1 
manipulative_W3 ~ f*ChronicPain_W2
manipulative_W2 ~ g*LogIncome_W1
ChronicPain_W3 ~ h*manipulative_W2
# Mediator effects - Education
manipulative_W2 ~ i*Education_W1
ChronicPain_W2 ~ j*Education_W1 
# Control for previous wave
manipulative_W3 ~ manipulative_W2
ChronicPain_W3 ~ ChronicPain_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
manipulative_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
manipulative_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
ChronicPain_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
manipulative_W2 ~~ ChronicPain_W2
manipulative_W3 ~~ ChronicPain_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.manipulative.chronicpain <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.manipulative.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "manipulative_W2"
m[3, 2] <- "ChronicPain_W2"
m[1, 3] <- "manipulative_W3"
m[4, 3] <- "ChronicPain_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("manipulative_W3 ~ Education_W1" = .20, 
                      "ChronicPain_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             manipulative_W2 = "Manipulative W2",
                             ChronicPain_W2 = "Chronic Pain W2", 
                             manipulative_W3 = "Manipulative W3",
                             ChronicPain_W3 = "Chronic Pain W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))

```

```{r path-manipulative-chronicpain, echo = FALSE, fig.cap="Path Model: SES, Manipulative Treatments, and Chronic Pain"}
# Create final plot
plot(path_dia5)
```

```{r de-manipulative-chronicpain, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "ChronicPain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Manipulative Treatments, and Chronic Pain",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-manipulative-chronicpain, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.manipulative.chronicpain <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.manipulative.chronicpain <- tab.IE.manipulative.chronicpain %>%
  slice(match(x, Path))
```

```{r ie-manipulative-chronicpain, echo=FALSE}
tab.IE.manipulative.chronicpain %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Manipulative Treatments, and Chronic Pain",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-manipulative-chronicpain, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Chronic Pain, and Manipulative Treatments Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### SEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3)

set seed 1234
gsem(manipulative_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (manipulative_W3 <- logincome_W1 education_W1 chronicpain_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (chronicpain_W3 <- logincome_W1 education_W1 chronicpain_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using manipulativechronicpain, pval ci replace

nlcom (_b[chronicpain_W2:logincome_W1]*_b[manipulative_W3:chronicpain_W2]) (_b[manipulative_W3:logincome_W1] + _b[chronicpain_W2:logincome_W1]*_b[manipulative_W3:chronicpain_W2]) (_b[manipulative_W2:logincome_W1]*_b[chronicpain_W3:manipulative_W2]) (_b[chronicpain_W3:logincome_W1] + _b[manipulative_W2:logincome_W1]*_b[chronicpain_W3:manipulative_W2]) (_b[chronicpain_W2:education_W1]*_b[manipulative_W3:chronicpain_W2]) (_b[manipulative_W3:education_W1] + _b[chronicpain_W2:education_W1]*_b[manipulative_W3:chronicpain_W2]) (_b[manipulative_W2:education_W1]*_b[chronicpain_W3:manipulative_W2]) (_b[chronicpain_W3:education_W1] + _b[manipulative_W2:education_W1]*_b[chronicpain_W3:manipulative_W2]), post

esttab using "iemanipulativechronicpain.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-manipulative-chronicpain-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/manipulativechronicpain.dta")
manipulativechronicpain <- read_dta(path)

# Convert to data frame
manipulativechronicpain <- as.data.frame(manipulativechronicpain)

# Add indicator column 
 
# Split name column into firstname and last name
manipulativechronicpain <-  manipulativechronicpain %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
manipulativechronicpain <- subset(manipulativechronicpain, select = -c(N) )
```

```{r de-gsem-manipulative-chronicpain, echo = FALSE}
manipulativechronicpain %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W2", "Chronic Pain Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "chronicpain_W3", "Chronic Pain Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>%  
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Manipulative Treatments, and Chronic Pain",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iemanipulativechronicpain-table, echo = FALSE}
# Import indirect and total effects table
iemanipulativechronicpain.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iemanipulativechronicpain.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iemanipulativechronicpain.table[] <- lapply(iemanipulativechronicpain.table, gsub, pattern='=', replacement='')

# Remove last row 
iemanipulativechronicpain.table <- head(iemanipulativechronicpain.table, - 1) 

# Rename columns
iemanipulativechronicpain.table <- iemanipulativechronicpain.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iemanipulativechronicpain.table <- iemanipulativechronicpain.table[-c(1,2), ]

# convert p-value to numeric
iemanipulativechronicpain.table$`p-value` <- as.numeric(iemanipulativechronicpain.table$`p-value`)

# Remove row names
rownames(iemanipulativechronicpain.table) <- NULL
```

```{r ie-gsem-manipulative-chronicpain, echo = FALSE}
iemanipulativechronicpain.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Chronic Pain \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Chronic Pain")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Manipulative Treatments, and Chronic Pain") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```

### Depression/Anxiety

#### SEM

```{r model-manipulative-dep, echo = FALSE, results='hide', fig.show='hide'}
model <- '
# Regressions
# Direct effect - log income 
manipulative_W3 ~ a*LogIncome_W1 
DepAnx_W3 ~ b*LogIncome_W1
# Direct Effect - Education
manipulative_W3 ~ c*Education_W1
DepAnx_W3 ~ d*Education_W1
# Mediator effects - Income 
DepAnx_W2 ~ e*LogIncome_W1 
manipulative_W3 ~ f*DepAnx_W2
manipulative_W2 ~ g*LogIncome_W1
DepAnx_W3 ~ h*manipulative_W2
# Mediator effects - Education
manipulative_W2 ~ i*Education_W1
DepAnx_W2 ~ j*Education_W1 
# Control for previous wave
manipulative_W3 ~ manipulative_W2
DepAnx_W3 ~ DepAnx_W2
# Indirect effect 
ef := e*f
gh := g*h
jf := j*f
ih := i*h
# total effect
total1 := a + (e*f)
total2 := b + (g*h)
total3 := c + (j*f)
total4 := d + (i*h)
# Controls
manipulative_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W2 ~ Sex_W1 + Age_W2 + Marital_W2 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
manipulative_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
DepAnx_W3 ~ Age_W3 + Sex_W1 + Marital_W3 + MexicanHispanic_W2 + Black_W2 + OtherRace_W2
# Covariances
manipulative_W2 ~~ DepAnx_W2
manipulative_W3 ~~ DepAnx_W3
'

# Run model and get summary and fit statistics
set.seed(1234)
model.summ <- sem(model, data = path.complete, se = "bootstrap")
summary(model.summ, standardized = TRUE, fit.measures = TRUE)
fitMeasures(model.summ, c("cfi", "rmsea", "srmr"))
#modificationindices(model.summ)

# Create object with model fit measures
fit.manipulative.dep <- lavInspect(model.summ, what = "fit")

# Create object with parameter estimates
est.manipulative.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized = TRUE)


m <- matrix(NA, 4, 3)
m[1, 1] <- "LogIncome_W1"
m[4, 1] <- "Education_W1"
m[2, 2] <- "manipulative_W2"
m[3, 2] <- "DepAnx_W2"
m[1, 3] <- "manipulative_W3"
m[4, 3] <- "DepAnx_W3"

# Drop controls from path diagram
path_dia <- semptools::drop_nodes(
                object = semPlotModel(model.summ),
                nodes = c("Age_W3", "Sex_W1", "Marital_W3", "HlthInsurance_W3", "HLSelf_W3", "Spiritual_W3", "Religion_W3", "MexicanHispanic_W2", "Black_W2", "OtherRace_W2", "Age_W2", "Marital_W2", "HlthInsurance_W2", "HLSelf_W2", "Spiritual_W2", "Religion_W2"))

# Create path diagram
path_dia2 <- semPaths(path_dia, whatLabels = "std",
           sizeMan = 8,
           edge.label.cex = .8,
           edge.color = "black",
           style = "ram",
           layout = m, 
           exoCov = FALSE,
           nCharNodes = 0, nCharEdges = 0)

# Create list to rearrange positions of node edges that were blocking each other
my_position_list <- c("manipulative_W3 ~ Education_W1" = .20, 
                      "DepAnx_W3 ~ LogIncome_W1" = .75)
# Change label position
path_dia3 <- set_edge_label_position(path_dia2, my_position_list)

path_dia4 <- change_node_label(path_dia3,
                           c(LogIncome_W1 = "Income W1",
                             Education_W1 = "Education W1",
                             manipulative_W2 = "Manipulative W2",
                             DepAnx_W2 = "DepAnx W2", 
                             manipulative_W3 = "Manipulative W3",
                             DepAnx_W3 = "DepAnx W3"),
                           label.cex = 1.1)

path_dia5 <- mark_sig(path_dia4, model.summ, alpha = c("(n.s.)" = 1.00, "*" = .05))




```

```{r path-manipulative-dep, echo = FALSE, fig.cap="Path Model: SES, Manipulative Treatments, and Depression/Anxiety"}
# Create final plot
plot(path_dia5)
```

```{r de-manipulative-dep, echo = FALSE}
# Create Direct Effects Table 
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == "~") %>%  
  select(Outcome=lhs, Indicator=rhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper, 'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() %>% 
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "Black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "OtherRace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "DepAnx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalCams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SumChron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "SRH_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "LogIncome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HlthInsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "HLSelf_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "MexicanHispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "Black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "OtherRace_W2", "Other Race")) %>% 
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>% 
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Direct Effects: SES, Manipulative Treatments, and Depression/Anxiety",
               escape = F, 
               col.names = c("Outcome", "Indicator", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 7) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()
```

```{r create-ie-manipulative-dep, echo = FALSE, results='hide'}
parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=")

# Create Indirect Effects Table 

# Convert output to dataframe with desired rows and columns 
tab.IE.manipulative.dep <- parameterEstimates(model.summ, boot.ci.type = "bca.simple", standardized=TRUE) %>% 
  filter(op == ":=") %>% 
  select('Path'=lhs, B=est, 'Lower CI'= ci.lower, 'Upper CI'= ci.upper,'p-value'=pvalue, Beta=std.all) %>%
  as.data.frame() 


# create a vector rows in desired order
x <- c("ef", "total1", "gh", "total2", "jf", "total3", "ih", "total4")

# Reorder rows
tab.IE.manipulative.dep <- tab.IE.manipulative.dep %>%
  slice(match(x, Path))
```

```{r ie-manipulative-dep, echo=FALSE}
tab.IE.manipulative.dep %>% 
  mutate(Path = replace(Path, Path == "ef", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total1", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "gh", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total2", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "jf", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "total3", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "ih", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "total4", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Indirect and Total Effects: SES, Manipulative Treatments, and Depression/Anxiety",                
               escape = F, 
               col.names = c("Path", "\\textit{b}", "Lower CI", 
                             "Upper CI", "\\textit{p}-value", " ", "$\\beta$")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient. 
                       $\\\\beta$ = standardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape() 

```

```{r fit-manipulative-dep, echo = FALSE}
# Create fit statistics table 
fitMeasures(model.summ, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea",  "srmr")) %>%
  as.data.frame() %>% 
  t() %>%  
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               caption="Fit Statistics: SES, Depression/Anxiety, and Manipulative Treatments Path Model",                
               escape = F,
               col.names=c("$\\chi^2$","df","\\textit{p}-value", "CFI", 
                           "TLI", "RMSEA", "SRMR")) %>%  
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  add_footnote(c("CFI = Comparitive Fit Index.", "TLI = Tucker Lewis-Index.", "RMSEA = root mean square error of approximation.", "SRMR = standardized root mean square residual."), notation = "none")
```

#### GSEM

```{stata, include=FALSE}
use path.dta, clear

rename (LogIncome_W1 Education_W1 Sex_W1 SumChron_W2 Age_W2 Marital_W2 HlthInsurance_W2 HLSelf_W2 Spiritual_W2 Religion_W2 MexicanHispanic_W2 Black_W2 OtherRace_W2 SumChron_W3 Age_W3 Marital_W3 HlthInsurance_W3 HLSelf_W3 Spiritual_W3 Religion_W3) (logincome_W1 education_W1 sex_W1 sumchron_W2 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2 sumchron_W3 age_W3 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3)

rename(totalCams_W2 totalCams_W3)(totalcams_W2 totalcams_W3)

rename(SRH_W2 SRH_W3)(srh_W2 srh_W3)

rename(Diabetes_W1 Diabetes_W2 Diabetes_W3 Respiratory_W1 Respiratory_W2 Respiratory_W3 DepAnx_W1 DepAnx_W2 DepAnx_W3 HighBP_W1 HighBP_W2 HighBP_W3 ChronicPain_W2 ChronicPain_W3 Depression_W2 Depression_W3) (diabetes_W1 diabetes_W2 diabetes_W3 respiratory_W1 respiratory_W2 respiratory_W3 depanx_W1 depanx_W2 depanx_W3 highbp_W1 highbp_W2 highbp_W3 chronicpain_W2 chronicpain_W3 depression_W2 depression_W3)

set seed 1234
gsem(manipulative_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 spiritual_W2 religion_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W2 <- logincome_W1 education_W1 sex_W1 age_W2 marital_W2 hlthinsurance_W2 hlself_W2 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (manipulative_W3 <- logincome_W1 education_W1 depanx_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 spiritual_W3 religion_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit) (depanx_W3 <- logincome_W1 education_W1 depanx_W2 manipulative_W2 age_W3 sex_W1 marital_W3 hlthinsurance_W3 hlself_W3 mexicanhispanic_W2 black_W2 otherrace_W2, logit)

regsave using manipulativedepression, pval ci replace

nlcom (_b[depanx_W2:logincome_W1]*_b[manipulative_W3:depanx_W2]) (_b[manipulative_W3:logincome_W1] + _b[depanx_W2:logincome_W1]*_b[manipulative_W3:depanx_W2]) (_b[manipulative_W2:logincome_W1]*_b[depanx_W3:manipulative_W2]) (_b[depanx_W3:logincome_W1] + _b[manipulative_W2:logincome_W1]*_b[depanx_W3:manipulative_W2]) (_b[depanx_W2:education_W1]*_b[manipulative_W3:depanx_W2]) (_b[manipulative_W3:education_W1] + _b[depanx_W2:education_W1]*_b[manipulative_W3:depanx_W2]) (_b[manipulative_W2:education_W1]*_b[depanx_W3:manipulative_W2]) (_b[depanx_W3:education_W1] + _b[manipulative_W2:education_W1]*_b[depanx_W3:manipulative_W2]), post

esttab using "iemanipulativedepression.csv", cells("b se p ci_l ci_u")  replace
```

```{r read-in-manipulative-depression-gsem-results, echo=FALSE}
path <- ("C:/Users/hanna/Documents/git/AHL/R/Mixed Model/manipulativedepression.dta")
manipulativedepression <- read_dta(path)

# Convert to data frame
manipulativedepression <- as.data.frame(manipulativedepression)

# Add indicator column 
 
# Split name column into firstname and last name
manipulativedepression <-  manipulativedepression %>% separate(var, 
                                   sep = "[:]",
                                   c('Outcome', 'Indicator'))

# Drop last column 
manipulativedepression <- subset(manipulativedepression, select = -c(N) )

```

```{r de-gsem-manipulative-depression, echo = FALSE}
manipulativedepression %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "pna_W2", "PNA Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W2", "Total Cams Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "totalcams_W3", "Total Cams Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "srh_W2", "SRH Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Indicator = replace(Indicator, Indicator == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "education_W1", "Education Wave 1")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "sex_W1", "Sex")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W2", "Age Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "age_W3", "Age Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W2", "Married Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "marital_W3", "Married Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "black_W2", "Black")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "_cons", "Constant")) %>%
  mutate(Indicator = replace(Indicator, Indicator == "otherrace_W2", "Other Race")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W2", "Depression/Anxiety Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "depanx_W3", "Depression/Anxiety Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W2", "Mind Body Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "mindbody_W3", "Mind Body Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W2", "Alt Med Wave 2")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "altmed_W3", "Alt Med Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "pna_W2", "PNA Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "pna_W3", "PNA Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W2", "Manipulative Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "manipulative_W3", "Manipulative Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W2", "Total CAMs Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "totalcams_W3", "Total CAMs Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W2", "Sum Chron Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sumchron_W3", "Sum Chron Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "srh_W2", "SRH Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "srh_W3", "SRH Wave 3")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "logincome_W1", "Logged Income Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "education_W1", "Education Wave 1")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "sex_W1", "Sex")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W2", "Age Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "age_W3", "Age Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W2", "Married Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "marital_W3", "Married Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W2", "Health Insurance Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlthinsurance_W3", "Health Insurance Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W2", "Health Locus of Control Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "hlself_W3", "Health Locus of Control Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W2", "Spirituality Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "spiritual_W3", "Spirituality Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W2", "Religiosity Wave 2")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "religion_W3", "Religiosity Wave 3")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "mexicanhispanic_W2", "Mexican American/Hispanic")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "black_W2", "Black")) %>%
  mutate(Outcome = replace(Outcome, Outcome == "otherrace_W2", "Other Race")) %>% 
  mutate(Outcome = replace(Outcome, Outcome == "_cons", "Constant")) %>%
  add_significance(p.col = "pval",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "pval") %>% 
  knitr::kable(digits = 3,
             booktabs=TRUE,
             caption="GSEM Direct Effects: SES, Manipulative Treatments, and Depression/Anxiety",
             escape = F,
             col.names = c("Outcome", "Indicator", "\\textit{b}", "Std. Error", 
                           "\\textit{p}-value", " ", "Lower CI", "Upper CI")) %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped"),
                font_size = 5) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient."),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>% 
  kableExtra::landscape() 
```

```{r read-in-iemanipulativedepression-table, echo = FALSE}
# Import indirect and total effects table
iemanipulativedepression.table <- read.csv(
  file = "C:/Users/hanna/Documents/git/AHL/R/Mixed model/iemanipulativedepression.csv",
  header = TRUE,
  sep = ","
)

# Remove = from entire dataframe
iemanipulativedepression.table[] <- lapply(iemanipulativedepression.table, gsub, pattern='=', replacement='')

# Remove last row 
iemanipulativedepression.table <- head(iemanipulativedepression.table, - 1) 

# Rename columns
iemanipulativedepression.table <- iemanipulativedepression.table %>% 
  rename(
    Path = X.,
    "b" = X..1.,
    se = X..1,
    "p-value" = X..2,
    "Lower CI" = X..3, 
    "Upper CI" = X..4
    )

# Remove first two rows
iemanipulativedepression.table <- iemanipulativedepression.table[-c(1,2), ]

# convert p-value to numeric
iemanipulativedepression.table$`p-value` <- as.numeric(iemanipulativedepression.table$`p-value`)

# Remove row names
rownames(iemanipulativedepression.table) <- NULL
```

```{r ie-gsem-manipulative-depression, echo = FALSE}
iemanipulativedepression.table %>% 
  mutate(Path = replace(Path, Path == "_nl_1", "Indirect Effect: Income \U2192 Depression/Anxiety \U2192 	Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_2", "Total Effect: Income \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_3", "Indirect Effect: Income \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_4", "Total Effect: Income \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_5", "Indirect Effect: Education \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_6", "Total Effect: Education \U2192 Depression/Anxiety \U2192 Manipulative Treatments")) %>%
  mutate(Path = replace(Path, Path == "_nl_7", "Indirect Effect: Education \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  mutate(Path = replace(Path, Path == "_nl_8", "Total Effect: Education \U2192 Manipulative Treatments \U2192 Depression/Anxiety")) %>%
  add_significance(p.col = "p-value",
                   output.col = "Significance Level",
                   cutpoints = c(0, 0.001, 0.01, 0.05, 1),
                   symbols = c("***", "**", "*", " ")) %>% 
  dplyr::relocate("Significance Level", .after = "p-value") %>%
  knitr::kable(digits = 3, 
               booktabs=TRUE, 
               escape = F, 
               col.names = c("Path", "\\textit{b}", "se", "\\textit{p}-value"," ", "Lower CI", "Upper CI"),
               caption="GSEM Indirect and Total Effects: SES, Manipulative Treatments, and Depression/Anxiety") %>%
  kable_classic(html_font = "CMU Serif") %>%
  kable_styling(latex_options = c("striped")) %>% 
  footnote(general = c("\\\\textit{b} = unstandardized coefficient"),
           symbol = c("$p<.05.$", "$p<.01.$", "$p<.001.$"),
           symbol_manual = c("$^{*}$", "$^{**}$", "$^{***}$"),
           threeparttable = TRUE, 
           footnote_as_chunk = TRUE, 
           escape = F) %>%  
  kableExtra::landscape()

```


\newpage

## Appendix B: Self-Reported Health Moderation Models

```{r wave-comp-educ-recodes, echo=FALSE}
waves12.wide.complete$Education_W1.2 <- factor(waves12.wide.complete$Education_W1, 
                                              levels = c("College Grad", 
                                                         "Less than High School", 
                                                         "HS Diploma/GED", 
                                                         "Some College/AA Degree", 
                                                         "Graduate or Professional Degree"))


waves23.wide.complete$Education_W2.2 <- factor(waves23.wide.complete$Education_W2, 
                                              levels = c("College Grad", 
                                                         "Less than High School", 
                                                         "HS Diploma/GED", 
                                                         "Some College/AA Degree", 
                                                         "Graduate or Professional Degree"))

waves13.wide.complete$Education_W1.2 <- factor(waves13.wide.complete$Education_W1, 
                                              levels = c("College Grad", 
                                                         "Less than High School", 
                                                         "HS Diploma/GED", 
                                                         "Some College/AA Degree", 
                                                         "Graduate or Professional Degree"))

```

```{r models-waves12-SRH-mod-income, echo = FALSE, results='hide'}

# Center diff SRH 
waves12.wide.complete$DiffSRHCenter <- scale(waves12.wide.complete$DiffSRH, scale = FALSE)
waves12.wide.complete$DiffSRHCenter <- as.numeric(waves12.wide.complete$DiffSRHCenter)
# Center log income 
waves12.wide.complete$LogIncomeCenter <- scale(waves12.wide.complete$LogIncome_W1, scale = FALSE)
waves12.wide.complete$LogIncomeCenter <- as.numeric(waves12.wide.complete$LogIncomeCenter)
# Create interaction term 
waves12.wide.complete$DiffSRHxLogIncome <- NA
waves12.wide.complete$DiffSRHxLogIncome <- waves12.wide.complete$DiffSRHCenter*waves12.wide.complete$LogIncomeCenter

# Run income model 
waves12.SRH.income.1 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter, data = waves12.wide.complete)

# Run income model 
waves12.SRH.income.2 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter + DiffSRHCenter*LogIncomeCenter, data = waves12.wide.complete)

# Add controls 
waves12.SRH.income.3 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter + DiffSRHCenter*LogIncomeCenter + Education_W1.2 + Age_W2 + Sex_W1 + Race_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2, data = waves12.wide.complete)

# Extract standard errors
waves12.SRH.income.1.se <- summary(waves12.SRH.income.1)$coef[,"Std. Error"]
waves12.SRH.income.2.se <- summary(waves12.SRH.income.2)$coef[,"Std. Error"]
waves12.SRH.income.3.se <- summary(waves12.SRH.income.3)$coef[,"Std. Error"]

```

```{r models-waves23-SRH-mod-income, echo = FALSE, results='hide'}

# Center diff SRH 
waves23.wide.complete$DiffSRHCenter <- scale(waves23.wide.complete$DiffSRH, scale = FALSE)
waves23.wide.complete$DiffSRHCenter <- as.numeric(waves23.wide.complete$DiffSRHCenter)
# Center log income 
waves23.wide.complete$LogIncomeCenter <- scale(waves23.wide.complete$LogIncome_W2, scale = FALSE)
# Create interaction term 
# waves23.wide.complete$DiffSRHxLogIncome <- NA
waves23.wide.complete$DiffSRHxLogIncome <- waves23.wide.complete$DiffSRHCenter*waves23.wide.complete$LogIncomeCenter


# Run income model 
waves23.SRH.income.1 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter, data = waves23.wide.complete)

# Run income model 
waves23.SRH.income.2 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter + DiffSRHCenter*LogIncomeCenter, data = waves23.wide.complete)

# Add Controls 
waves23.SRH.income.3 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter + DiffSRHCenter*LogIncomeCenter + Education_W2.2 + Age_W3 + Sex_W2 + Race_W2 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3, data = waves23.wide.complete)

# Extract standard errors
waves23.SRH.income.1.se <- summary(waves23.SRH.income.1)$coef[,"Std. Error"]
waves23.SRH.income.2.se <- summary(waves23.SRH.income.2)$coef[,"Std. Error"]
waves23.SRH.income.3.se <- summary(waves23.SRH.income.3)$coef[,"Std. Error"]
```

```{r models-waves13-SRH-mod-income, echo = FALSE, results='hide'}

# Center diff chron 
waves13.wide.complete$DiffSRHCenter <- scale(waves13.wide.complete$DiffSRH, scale = FALSE)
waves13.wide.complete$DiffSRHCenter <- as.numeric(waves13.wide.complete$DiffSRHCenter)
# Center log income 
waves13.wide.complete$LogIncomeCenter <- scale(waves13.wide.complete$LogIncome_W1, scale = FALSE)
# Create interaction term 
waves13.wide.complete$DiffSRHxLogIncome <- waves13.wide.complete$DiffSRHCenter*waves13.wide.complete$LogIncomeCenter

# Run income model 
waves13.SRH.income.1 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter, data = waves13.wide.complete)

# Run income model 
waves13.SRH.income.2 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter + DiffSRHCenter*LogIncomeCenter, data = waves13.wide.complete)


# Add Controls
waves13.SRH.income.3 <- lm(formula = DiffCams ~ DiffSRHCenter + LogIncomeCenter + DiffSRHCenter*LogIncomeCenter + Education_W1.2 + Age_W3 + Sex_W1 + Race_W3 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3, data = waves13.wide.complete)

# Extract standard errors
waves13.SRH.income.1.se <- summary(waves13.SRH.income.1)$coef[,"Std. Error"]
waves13.SRH.income.2.se <- summary(waves13.SRH.income.2)$coef[,"Std. Error"]
waves13.SRH.income.3.se <- summary(waves13.SRH.income.3)$coef[,"Std. Error"]
```

```{r models-waves12-SRH-mod-educ, echo = FALSE, results='hide'}

# Run income model 
waves12.SRH.educ.1 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W1.2, data = waves12.wide.complete)

# Run income model 
waves12.SRH.educ.2 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W1.2 + DiffSRHCenter*Education_W1.2, data = waves12.wide.complete)

# Add Controls
waves12.SRH.educ.3 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W1.2 + DiffSRHCenter*Education_W1.2 + LogIncome_W1 + Age_W2 + Sex_W1 + Race_W2 + Marital_W2 + HlthInsurance_W2 + HLSelf_W2 + Spiritual_W2 + Religion_W2, data = waves12.wide.complete)

# Extract standard errors
waves12.SRH.educ.1.se <- summary(waves12.SRH.educ.1)$coef[,"Std. Error"]
waves12.SRH.educ.2.se <- summary(waves12.SRH.educ.2)$coef[,"Std. Error"]
waves12.SRH.educ.3.se <- summary(waves12.SRH.educ.3)$coef[,"Std. Error"]
```

```{r models-waves23-SRH-mod-educ, echo = FALSE, results='hide'}

# Run income model 
waves23.SRH.educ.1 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W2.2, data = waves23.wide.complete)

# Run income model 
waves23.SRH.educ.2 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W2.2 + DiffSRHCenter*Education_W2.2, data = waves23.wide.complete)

# Add Controls 
waves23.SRH.educ.3 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W2.2 + DiffSRHCenter*Education_W2.2 + LogIncome_W2 + Age_W3 + Sex_W2 + Race_W2 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3, data = waves23.wide.complete)

# Extract standard errors
waves23.SRH.educ.1.se <- summary(waves23.SRH.educ.1)$coef[,"Std. Error"]
waves23.SRH.educ.2.se <- summary(waves23.SRH.educ.2)$coef[,"Std. Error"]
waves23.SRH.educ.3.se <- summary(waves23.SRH.educ.3)$coef[,"Std. Error"]
```

```{r models-waves13-SRH-mod-educ, echo = FALSE, results='hide'}

# Run income model 
waves13.SRH.educ.1 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W1.2, data = waves13.wide.complete)

# Run income model 
waves13.SRH.educ.2 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W1.2 + DiffSRHCenter*Education_W1.2, data = waves13.wide.complete)

# Add Controls 
waves13.SRH.educ.3 <- lm(formula = DiffCams ~ DiffSRHCenter + Education_W1.2 + DiffSRHCenter*Education_W1.2 + LogIncome_W1 + Age_W3 + Sex_W1 + Race_W3 + Marital_W3 + HlthInsurance_W3 + HLSelf_W3 + Spiritual_W3 + Religion_W3, data = waves13.wide.complete)

# Extract standard errors
waves13.SRH.educ.1.se <- summary(waves13.SRH.educ.1)$coef[,"Std. Error"]
waves13.SRH.educ.2.se <- summary(waves13.SRH.educ.2)$coef[,"Std. Error"]
waves13.SRH.educ.3.se <- summary(waves13.SRH.educ.3)$coef[,"Std. Error"]
```

### Income as Moderator

```{r waves12-SRH-mod-income, echo = FALSE, results='asis'}
# Create regression results table
stargazer(waves12.SRH.income.1, waves12.SRH.income.2, waves12.SRH.income.3,
          title = "Waves 1 and 2 Difference in CAMs Regressed on Difference in SRH Moderated by Income", 
          column.labels = c("Model 1", "Model 2", "Model 3"), 
          covariate.labels = c("Difference in SRH", "Logged Income", 
                               "Less than High School", "HS Diploma/GED", 
                               "Some College/AA Degree", "Graduate/Professional Degree",
                               "Age at Wave 2", "Female", "Non-Hispanic Black", 
                               "Mexican American and Other Hispanic", "Other Race",
                               "Married", "Insured", "Health Locus of Control",
                               "Spirituality", "Religiosity", 
                               "Difference in SRH x Logged Income"),
          dep.var.caption  = "", 
          dep.var.labels.include = FALSE,
          model.numbers          = FALSE, 
          keep.stat = c("n", "rsq", "adj.rsq"), 
          column.sep.width = "3pt", # to reduce column width
          single.row = TRUE, # to put coefficients and standard errors on same line
          font.size = "small",
          header = FALSE, 
          notes = c("White is the reference category for race.", 
                    "Standard errors shown in parentheses.", 
                    "SRH: Self-Reported Health."), 
          notes.align = "r", 
          label = "tab:waves12-SRH-mod-income",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.05, .01, .001)) 

```

```{r plot-waves12-SRH-income-3, echo = FALSE, fig.cap= "Income Moderation Effects on Relationship Between Difference in Self-Reported Health and Difference in Total CAMs Used Between Waves 1 and 2"}
library(interactions)
interact_plot(waves12.SRH.income.3, pred = DiffSRHCenter, modx = LogIncomeCenter, 
              x.label = "Difference in Self-Reported Health", 
              y.label = "Difference in Total CAMs",
              legend.main = "Logged Income")
```

```{r waves23-SRH-mod-income, echo = FALSE, results='asis'}
# Create regression results table
stargazer(waves23.SRH.income.1, waves23.SRH.income.2, waves23.SRH.income.3, 
          title = "Waves 2 and 3 Difference in CAMs Regressed on Difference in SRH Moderated by Income", 
          column.labels = c("Model 1", "Model 2", "Model 3"), 
          covariate.labels = c("Difference in SRH", "Logged Income", 
                               "Less than High School", "HS Diploma/GED", 
                               "Some College/AA Degree", "Graduate/Professional Degree",
                               "Age at Wave 3", "Female", "Non-Hispanic Black", 
                               "Mexican American and Other Hispanic", "Other Race",
                               "Married", "Insured", "Health Locus of Control",
                               "Spirituality", "Religiosity", 
                               "Difference in SRH x Logged Income"),
          dep.var.caption  = "", 
          dep.var.labels.include = FALSE,
          model.numbers          = FALSE, 
          keep.stat = c("n", "rsq", "adj.rsq"), 
          column.sep.width = "3pt", # to reduce column width
          single.row = TRUE, # to put coefficients and standard errors on same line
          font.size = "small",
          header = FALSE, 
          notes = c("White is the reference category for race.", 
                    "Standard errors shown in parentheses.", 
                    "SRH: Self-Reported Health."), 
          notes.align = "r", 
          label = "tab:waves23-SRH-mod-income",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.05, .01, .001)) 

```

```{r plot-waves23-SRH-income-3, echo = FALSE, fig.cap= "Income Moderation Effects on Relationship Between Difference in Self-Reported Health and Difference in Total CAMs Used Between Waves 2 and 3"}
library(interactions)
interact_plot(waves23.SRH.income.3, pred = DiffSRHCenter, modx = LogIncomeCenter, 
              x.label = "Difference in Self-Reported Health", 
              y.label = "Difference in Total CAMs",
              legend.main = "Logged Income")
```

```{r waves13-SRH-mod-income, echo = FALSE, results='asis'}
# Create regression results table
stargazer(waves13.SRH.income.1, waves13.SRH.income.2, waves13.SRH.income.3,
          title = "Waves 1 and 3 Difference in CAMs Regressed on Difference in SRH Moderated by Income", 
          column.labels = c("Model 1", "Model 2", "Model 3"), 
          covariate.labels = c("Difference in SRH", "Logged Income", 
                               "Less than High School", "HS Diploma/GED", 
                               "Some College/AA Degree", "Graduate/Professional Degree",
                               "Age at Wave 3", "Female", "Non-Hispanic Black", 
                               "Mexican American and Other Hispanic", "Other Race",
                               "Married", "Insured", "Health Locus of Control",
                               "Spirituality", "Religiosity", 
                               "Difference in SRH x Logged Income"),
          dep.var.caption  = "", 
          dep.var.labels.include = FALSE,
          model.numbers          = FALSE, 
          keep.stat = c("n", "rsq", "adj.rsq"), 
          column.sep.width = "3pt", # to reduce column width
          single.row = TRUE, # to put coefficients and standard errors on same line
          font.size = "small",
          header = FALSE,
          notes = c("White is the reference category for race.", 
                    "Standard errors shown in parentheses.", 
                    "SRH: Self-Reported Health"), 
          notes.align = "r", 
          label = "tab:waves13-SRH-mod-income",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.05, .01, .001))

```

```{r plot-waves13-SRH-income-3, echo = FALSE, fig.cap= "Income Moderation Effects on Relationship Between Difference in Self-Reported Health and Difference in Total CAMs Used Between Waves 1 and 3"}
library(interactions)
interact_plot(waves13.SRH.income.3, pred = DiffSRHCenter, modx = LogIncomeCenter, 
              x.label = "Difference in Self-Reported Health", 
              y.label = "Difference in Total CAMs",
              legend.main = "Logged Income")
```

### Education as Moderator

```{r plot-waves12-SRH-educ-3, echo=FALSE, fig.cap= "Education Moderation Effects on Relationship Between Difference in SRH and Difference in Total CAMs Used Between Waves 1 and 2"}
plot_model(waves12.SRH.educ.3, 
           type = "pred", 
           terms = c("DiffSRHCenter", "Education_W1.2"), 
           title = "",
           axis.title = c("Difference in SRH", "Difference in CAMs"),
           legend.title = "Education")

```

```{r waves12-SRH-mod-educ, echo = FALSE, results='asis'}
# Create regression results table
stargazer(waves12.SRH.educ.1, waves12.SRH.educ.2, waves12.SRH.educ.3,  
          title = "Waves 1 and 2 Difference in CAMs Regressed on Difference in SRH Moderated by Education", 
          column.labels = c("Model 1", "Model 2", "Model 3"), 
          covariate.labels = c("Difference in SRH", "Less than high school", "HS Diploma/GED", 
                               "Some College/AA Degree","Graduate or Professional Degree",
                               "Logged Income", "Age at Wave 2",
                               "Female", "Non-Hispanic Black", 
                               "Mexican American and Other Hispanic", "Other Race", "Married", 
                               "Insured", "Health Locus of Control", "Spirituality", "Religiosity", 
                               "Difference in Chronic Conditions x Less than HS Diploma", 
                               "Difference in Chronic Conditions x High School Diploma/GED", 
                               "Difference in Chronic Conditions x Some College/AA Degree", 
                               "Difference in Chronic Conditions x Professional or Graduate Degree"),
          dep.var.caption  = "", 
          dep.var.labels.include = FALSE,
          model.numbers          = FALSE, 
          keep.stat = c("n", "rsq", "adj.rsq"), 
          column.sep.width = "3pt", # to reduce column width
          single.row = TRUE, # to put coefficients and standard errors on same line
          font.size = "small",
          header = FALSE,
          notes = c("College graduate is the reference category for education.", 
                    "White is the reference category for race.", 
                    "Standard errors shown in parentheses.", 
                    "SRH: Self-Reported Health."), 
          notes.align = "r", 
          float.env = "sidewaystable", 
          label = "tab:waves12-SRH-mod-educ",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.05, .01, .001))
```

```{r plot-waves23-SRH-educ-3, echo=FALSE, fig.cap= "Education Moderation Effects on Relationship Between Difference in SRH and Difference in Total CAMs Used Between Waves 2 and 3"}
plot_model(waves23.SRH.educ.3, 
           type = "pred", 
           terms = c("DiffSRHCenter", "Education_W2.2"), 
           title = "",
           axis.title = c("Difference in SRH", "Difference in CAMs"),
           legend.title = "Education")

```

```{r waves23-SRH-mod-educ, echo = FALSE, results='asis'}
# Create regression results table
stargazer(waves23.SRH.educ.1, waves23.SRH.educ.2, waves23.SRH.educ.3,  
          title = "Waves 2 and 3 Difference in CAMs Regressed on Difference in SRH Moderated by Education", 
          column.labels = c("Model 1", "Model 2", "Model 3"), 
          covariate.labels = c("Difference in SRH", "Less than high school", "HS Diploma/GED", 
                               "Some College/AA Degree", "Graduate or Professional Degree",
                               "Logged Income", "Age at Wave 2",
                               "Female", "Non-Hispanic Black", 
                               "Mexican American and Other Hispanic", "Other Race", "Married", 
                               "Insured", "Health Locus of Control", "Spirituality", "Religiosity", 
                               "Difference in Chronic Conditions x Less than HS Diploma", 
                               "Difference in Chronic Conditions x High School Diploma/GED", 
                               "Difference in Chronic Conditions x Some College/AA Degree", 
                               "Difference in Chronic Conditions x Professional or Graduate Degree"),
          dep.var.caption  = "", 
          dep.var.labels.include = FALSE,
          model.numbers          = FALSE, 
          keep.stat = c("n", "rsq", "adj.rsq"), 
          column.sep.width = "3pt", # to reduce column width
          single.row = TRUE, # to put coefficients and standard errors on same line
          font.size = "small",
          header = FALSE,
          notes = c("College graduate is the reference category for education.", 
                    "White is the reference category for race.", 
                    "Standard errors shown in parentheses.", 
                    "SRH: Self-Reported Health."), 
          notes.align = "r", 
          float.env = "sidewaystable", 
          label = "tab:waves12-SRH-mod-educ",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.05, .01, .001))
```

```{r plot-waves13-SRH-educ-3, echo=FALSE, fig.cap= "Education Moderation Effects on Relationship Between Difference in SRH and Difference in Total CAMs Used Between Waves 1 and 3"}
plot_model(waves12.SRH.educ.3, 
           type = "pred", 
           terms = c("DiffSRHCenter", "Education_W1.2"), 
           title = "",
           axis.title = c("Difference in SRH", "Difference in CAMs"),
           legend.title = "Education")

```

```{r waves13-SRH-mod-educ, echo = FALSE, results='asis'}
# Create regression results table
stargazer(waves13.SRH.educ.1, waves13.SRH.educ.2, waves13.SRH.educ.3, 
          title = "Waves 1 and 3 Difference in CAMs Regressed on Difference in SRH Moderated by Education", 
          column.labels = c("Model 1", "Model 2", "Model 3"), 
          covariate.labels = c("Difference in SRH", "Less than high school", "HS Diploma/GED", 
                               "Some College/AA Degree","Graduate or Professional Degree",
                               "Logged Income", "Age at Wave 2",
                               "Female", "Non-Hispanic Black", 
                               "Mexican American and Other Hispanic", "Other Race", "Married", 
                               "Insured", "Health Locus of Control", "Spirituality", "Religiosity", 
                               "Difference in Chronic Conditions x Less than HS Diploma", 
                               "Difference in Chronic Conditions x High School Diploma/GED", 
                               "Difference in Chronic Conditions x Some College/AA Degree", 
                               "Difference in Chronic Conditions x Professional or Graduate Degree"),
          dep.var.caption  = "", 
          dep.var.labels.include = FALSE,
          model.numbers          = FALSE, 
          keep.stat = c("n", "rsq", "adj.rsq"), 
          column.sep.width = "3pt", # to reduce column width
          single.row = TRUE, # to put coefficients and standard errors on same line
          font.size = "small",
          header = FALSE,
          notes = c("College graduate is the reference category for education.", 
                    "White is the reference category for race.", 
                    "Standard errors shown in parentheses.", 
                    "SRH: Self-Reported Health."), 
          notes.align = "r", 
          float.env = "sidewaystable", 
          label = "tab:waves13-SRH-mod-educ",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.05, .01, .001))
```
