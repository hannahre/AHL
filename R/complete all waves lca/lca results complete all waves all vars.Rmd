---
title: "lca results complete all waves all cams"
author: "Hannah Andrews"
date: "11/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(DT)

setwd("C:/Users/hanna/Documents/git/AHL/R/complete all waves lca")
load("complete_wave1_all_lca.rda")
load("complete_wave1_all_table.rda")
load("complete_wave2_all_lca.rda")
load("complete_wave2_all_table.rda")
load("complete_wave3_all_lca.rda")
load("complete_wave3_all_table.rda")
```

# Model Fit and Class Sizes 

## Wave 1
```{r, echo = FALSE}
wave1alltable
```
AIC 6 classes. BIC 4 classes. Entropy low. <5% classes started at 3 classes. 

```{r, echo = FALSE}
# Class sizes
table(wave1all[[3]]$predclass)
round(prop.table(table(wave1all[[3]]$predclass)),4)*100
table(wave1all[[4]]$predclass)
round(prop.table(table(wave1all[[4]]$predclass)),4)*100
table(wave1all[[5]]$predclass)
round(prop.table(table(wave1all[[5]]$predclass)),4)*100
table(wave1all[[6]]$predclass)
round(prop.table(table(wave1all[[6]]$predclass)),4)*100
```

## Wave 2 
```{r, echo = FALSE}
wave2alltable
```
AIC 6 classes. BIC 3 classes. Entropy higher than wave 1 but still low. Classes less than 5% for 5 class model only. 

```{r, echo = FALSE}
# Class sizes
table(wave2all[[3]]$predclass)
round(prop.table(table(wave2all[[3]]$predclass)),4)*100
table(wave2all[[4]]$predclass)
round(prop.table(table(wave2all[[4]]$predclass)),4)*100
table(wave2all[[5]]$predclass)
round(prop.table(table(wave2all[[5]]$predclass)),4)*100
table(wave2all[[6]]$predclass)
round(prop.table(table(wave2all[[6]]$predclass)),4)*100
```

## Wave 3
```{r, echo = FALSE}
wave3alltable
```
AIC 6 classes. BIC 3 classes. Entropy higher than wave 1 but still low. Classes less than 5% starting with 4 classes. 

```{r, echo = FALSE}
table(wave3all[[3]]$predclass)
round(prop.table(table(wave3all[[3]]$predclass)),4)*100
table(wave3all[[4]]$predclass)
round(prop.table(table(wave3all[[4]]$predclass)),4)*100
table(wave3all[[5]]$predclass)
round(prop.table(table(wave3all[[5]]$predclass)),4)*100
table(wave3all[[6]]$predclass)
round(prop.table(table(wave3all[[6]]$predclass)),4)*100
```

# 3 Class Model 

## Wave 1 
```{r, echo = FALSE}
# Create dataframe of yes probabilities 
# Unstack list of probabilities
test <- unstack(data.frame(d<-unlist(wave1all[[3]]$probs), use.names = TRUE))
# Convert unstacked list into matrix with 3 rows corresponding to classes and 26 columns corresponding to no yes probabilities
test2 <- matrix(test[,1], nrow=3, ncol=26)
# Convert matrix to dataframe
test2 <- as.data.frame(test2)
# Select only even columns - correspond with yes probabilities
wave1all.3 <- test2 %>%
  select(everything()[c(FALSE, TRUE)])
# Result is 3 by 13 matrix of yes probabilities 
# Rename columns to corresponding CAMs
colnames(wave1all.3) <- c("Acupuncture","Chiropractic","EnergyHeal","ExerciseMove","Herbal",
                     "Vitamins","Homeopathy","Hypnosis","ImageryTech","Massage",
                     "RelaxMeditate","SpecialDiet","PraySpirit")
# Rename rows after model #
rownames(wave1all.3) <- c("Model 1", "Model 2", "Model 3")

# Saving code in case it comes in handy later. https://rstudio.github.io/DT/010-style.html
# create 19 breaks and 20 rgb color values ranging from white to red
brks <- quantile(wave1all.3, probs = seq(.05, .95, .05), na.rm = TRUE)
clrs <- round(seq(255, 40, length.out = length(brks) + 1), 0) %>%
  {paste0("rgb(255,", ., ",", ., ")")}
color.wave1all.3 <- datatable(wave1all.3) %>% 
  formatStyle(names(wave1all.3), backgroundColor = styleInterval(brks, clrs)) %>% 
  formatRound(columns = 1:13, 2)
color.wave1all.3
```
Class 1: Exercise movement, herbal, imagery tech (?), massage, meditation, prayer
Class 2: Prayer
Class 3: Nothing 

## Wave 2
```{r, echo = FALSE}
# Create dataframe of yes probabilities 
# Unstack list of probabilities
test <- unstack(data.frame(d<-unlist(wave2all[[3]]$probs), use.names = TRUE))
# Convert unstacked list into matrix with 3 rows corresponding to classes and 26 columns corresponding to no yes probabilities
test2 <- matrix(test[,1], nrow=3, ncol=26)
# Convert matrix to dataframe
test2 <- as.data.frame(test2)
# Select only even columns - correspond with yes probabilities
wave2all.3 <- test2 %>%
  select(everything()[c(FALSE, TRUE)])
# Result is 3 by 13 matrix of yes probabilities 
# Rename columns to corresponding CAMs
colnames(wave2all.3) <- c("Acupuncture","Chiropractic","EnergyHeal","ExerciseMove","Herbal",
                     "Vitamins","Homeopathy","Hypnosis","ImageryTech","Massage",
                     "RelaxMeditate","SpecialDiet","PraySpirit")
# Rename rows after model #
rownames(wave2all.3) <- c("Model 1", "Model 2", "Model 3")

# Saving code in case it comes in handy later. https://rstudio.github.io/DT/010-style.html
# create 19 breaks and 20 rgb color values ranging from white to red
brks <- quantile(wave2all.3, probs = seq(.05, .95, .05), na.rm = TRUE)
clrs <- round(seq(255, 40, length.out = length(brks) + 1), 0) %>%
  {paste0("rgb(255,", ., ",", ., ")")}
color.wave2all.3 <- datatable(wave2all.3) %>% 
  formatStyle(names(wave2all.3), backgroundColor = styleInterval(brks, clrs)) %>% 
  formatRound(columns = 1:13, 2)
color.wave2all.3
```
Class 1: Meditation and prayer 
Class 2: Exercise, herbal, vitamins, homeopathy, massage, meditation, diet, prayer
Class 3: Nothing 

## Wave 3
```{r, echo = FALSE}
# Create dataframe of yes probabilities 
# Unstack list of probabilities
test <- unstack(data.frame(d<-unlist(wave3all[[3]]$probs), use.names = TRUE))
# Convert unstacked list into matrix with 3 rows corresponding to classes and 26 columns corresponding to no yes probabilities
test2 <- matrix(test[,1], nrow=3, ncol=26)
# Convert matrix to dataframe
test2 <- as.data.frame(test2)
# Select only even columns - correspond with yes probabilities
wave3all.3 <- test2 %>%
  select(everything()[c(FALSE, TRUE)])
# Result is 3 by 13 matrix of yes probabilities 
# Rename columns to corresponding CAMs
colnames(wave3all.3) <- c("Acupuncture","Chiropractic","EnergyHeal","ExerciseMove","Herbal",
                     "Vitamins","Homeopathy","Hypnosis","ImageryTech","Massage",
                     "RelaxMeditate","SpecialDiet","PraySpirit")
# Rename rows after model #
rownames(wave3all.3) <- c("Model 1", "Model 2", "Model 3")

# Saving code in case it comes in handy later. https://rstudio.github.io/DT/010-style.html
# create 19 breaks and 20 rgb color values ranging from white to red
brks <- quantile(wave3all.3, probs = seq(.05, .95, .05), na.rm = TRUE)
clrs <- round(seq(255, 40, length.out = length(brks) + 1), 0) %>%
  {paste0("rgb(255,", ., ",", ., ")")}
color.wave3all.3 <- datatable(wave3all.3) %>% 
  formatStyle(names(wave3all.3), backgroundColor = styleInterval(brks, clrs)) %>% 
  formatRound(columns = 1:13, 2)
color.wave3all.3
```
Class 1: Nothing 
Class 2: Chiropractic, Exercise, Herbal, Vitamins, Homeopathy, massage, meditation, diet, prayer
Class 3: Meditation, prayer 

# 4 Class Model 
## Wave 1 
```{r, echo = FALSE}
# Create dataframe of yes probabilities 
# Unstack list of probabilities
test <- unstack(data.frame(d<-unlist(wave1all[[4]]$probs), use.names = TRUE))
# Convert unstacked list into matrix with 3 rows corresponding to classes and 26 columns corresponding to no yes probabilities
test2 <- matrix(test[,1], nrow=4, ncol=26)
# Convert matrix to dataframe
test2 <- as.data.frame(test2)
# Select only even columns - correspond with yes probabilities
wave1all.4 <- test2 %>%
  select(everything()[c(FALSE, TRUE)])
# Result is 4 by 13 matrix of yes probabilities 
# Rename columns to corresponding CAMs
colnames(wave1all.4) <- c("Acupuncture","Chiropractic","EnergyHeal","ExerciseMove","Herbal",
                     "Vitamins","Homeopathy","Hypnosis","ImageryTech","Massage",
                     "RelaxMeditate","SpecialDiet","PraySpirit")
# Rename rows after model #
rownames(wave1all.4) <- c("Model 1", "Model 2", "Model 3", "Model 4")

# Saving code in case it comes in handy later. https://rstudio.github.io/DT/010-style.html
# create 19 breaks and 20 rgb color values ranging from white to red
brks <- quantile(wave1all.4, probs = seq(.05, .95, .05), na.rm = TRUE)
clrs <- round(seq(255, 40, length.out = length(brks) + 1), 0) %>%
  {paste0("rgb(255,", ., ",", ., ")")}
color.wave1all.4 <- datatable(wave1all.4) %>% 
  formatStyle(names(wave1all.4), backgroundColor = styleInterval(brks, clrs)) %>% 
  formatRound(columns = 1:13, 3)
color.wave1all.4
```
Class 1: Nothing 
Class 2: Meditation and Prayer
Class 3: Nothing 
Class 4: Exercise, herbal, massage, meditation, prayer

## Wave 2 
```{r, echo = FALSE}
# Create dataframe of yes probabilities 
# Unstack list of probabilities
test <- unstack(data.frame(d<-unlist(wave2all[[4]]$probs), use.names = TRUE))
# Convert unstacked list into matrix with 3 rows corresponding to classes and 26 columns corresponding to no yes probabilities
test2 <- matrix(test[,1], nrow=4, ncol=26)
# Convert matrix to dataframe
test2 <- as.data.frame(test2)
# Select only even columns - correspond with yes probabilities
wave2all.4 <- test2 %>%
  select(everything()[c(FALSE, TRUE)])
# Result is 4 by 13 matrix of yes probabilities 
# Rename columns to corresponding CAMs
colnames(wave2all.4) <- c("Acupuncture","Chiropractic","EnergyHeal","ExerciseMove","Herbal",
                     "Vitamins","Homeopathy","Hypnosis","ImageryTech","Massage",
                     "RelaxMeditate","SpecialDiet","PraySpirit")
# Rename rows after model #
rownames(wave2all.4) <- c("Model 1", "Model 2", "Model 3", "Model 4")

# Saving code in case it comes in handy later. https://rstudio.github.io/DT/010-style.html
# create 19 breaks and 20 rgb color values ranging from white to red
brks <- quantile(wave2all.4, probs = seq(.05, .95, .05), na.rm = TRUE)
clrs <- round(seq(255, 40, length.out = length(brks) + 1), 0) %>%
  {paste0("rgb(255,", ., ",", ., ")")}
color.wave2all.4 <- datatable(wave2all.4) %>% 
  formatStyle(names(wave2all.4), backgroundColor = styleInterval(brks, clrs)) %>% 
  formatRound(columns = 1:13, 3)
color.wave2all.4
```

Class 1: Herbal, Vitamins, Diet, Prayer
Class 2: Meditation, Prayer
Class 3: Chiropractic, Exercise, Herbal, Vitamins, Homeopathy, Massage, Meditation, Diet, Prayer
Class 4: Nothing 

## Wave 3 
```{r, echo = FALSE}
# Create dataframe of yes probabilities 
# Unstack list of probabilities
test <- unstack(data.frame(d<-unlist(wave3all[[4]]$probs), use.names = TRUE))
# Convert unstacked list into matrix with 3 rows corresponding to classes and 26 columns corresponding to no yes probabilities
test2 <- matrix(test[,1], nrow=4, ncol=26)
# Convert matrix to dataframe
test2 <- as.data.frame(test2)
# Select only even columns - correspond with yes probabilities
wave3all.4 <- test2 %>%
  select(everything()[c(FALSE, TRUE)])
# Result is 4 by 13 matrix of yes probabilities 
# Rename columns to corresponding CAMs
colnames(wave3all.4) <- c("Acupuncture","Chiropractic","EnergyHeal","ExerciseMove","Herbal",
                     "Vitamins","Homeopathy","Hypnosis","ImageryTech","Massage",
                     "RelaxMeditate","SpecialDiet","PraySpirit")
# Rename rows after model #
rownames(wave3all.4) <- c("Model 1", "Model 2", "Model 3", "Model 4")

# Saving code in case it comes in handy later. https://rstudio.github.io/DT/010-style.html
# create 19 breaks and 20 rgb color values ranging from white to red
brks <- quantile(wave3all.4, probs = seq(.05, .95, .05), na.rm = TRUE)
clrs <- round(seq(255, 40, length.out = length(brks) + 1), 0) %>%
  {paste0("rgb(255,", ., ",", ., ")")}
color.wave3all.4 <- datatable(wave3all.4) %>% 
  formatStyle(names(wave3all.4), backgroundColor = styleInterval(brks, clrs)) %>% 
  formatRound(columns = 1:13, 3)
color.wave3all.4
```

Class 1: Acupuncture, Chiropractic, Energy healing, Exercise/Movement, Herbal, Vitamins, Homeopathy, Imagery, Massage, Meditation, Diet, Prayer
Class 2: Nothing
Class 3: Meditation, Prayer 
Class 4: Exercise, Herbal, Vitamins, Massage, Meditation, Diet, Prayer